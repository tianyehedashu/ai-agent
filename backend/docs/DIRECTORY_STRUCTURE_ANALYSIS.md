# åç«¯ç›®å½•ç»“æ„åˆ†ææŠ¥å‘Š

> **åˆ†ææ—¥æœŸ**: 2026-01-12
> **å¯¹æ¯”æ–‡æ¡£**: AI-Agentç³»ç»Ÿæ¶æ„è®¾è®¡æ–‡æ¡£.md
> **åˆ†æç›®æ ‡**: è¯„ä¼°ç›®å½•ç»“æ„æ˜¯å¦ç¬¦åˆè½¯ä»¶å·¥ç¨‹æœ€ä½³å®è·µå’Œæ¶æ„è®¾è®¡

---

## ä¸€ã€å½“å‰ç›®å½•ç»“æ„æ¦‚è§ˆ

```
backend/
â”œâ”€â”€ alembic/              # æ•°æ®åº“è¿ç§»
â”œâ”€â”€ api/                   # API è·¯ç”±å±‚
â”‚   â”œâ”€â”€ v1/               # API v1 ç‰ˆæœ¬
â”‚   â”œâ”€â”€ deps.py           # ä¾èµ–æ³¨å…¥
â”‚   â””â”€â”€ errors.py         # é”™è¯¯å¤„ç†
â”œâ”€â”€ app/                   # åº”ç”¨å…¥å£
â”‚   â”œâ”€â”€ config.py         # é…ç½®ç®¡ç†
â”‚   â””â”€â”€ main.py           # FastAPI åº”ç”¨
â”œâ”€â”€ core/                  # æ ¸å¿ƒä¸šåŠ¡é€»è¾‘
â”‚   â”œâ”€â”€ auth/             # è®¤è¯æˆæƒ
â”‚   â”œâ”€â”€ context/          # ä¸Šä¸‹æ–‡ç®¡ç†
â”‚   â”œâ”€â”€ engine/           # Agent å¼•æ“
â”‚   â”œâ”€â”€ llm/              # LLM ç½‘å…³
â”‚   â”œâ”€â”€ lsp/              # LSP é›†æˆ
â”‚   â”œâ”€â”€ memory/           # è®°å¿†ç³»ç»Ÿ
â”‚   â”œâ”€â”€ quality/          # ä»£ç è´¨é‡
â”‚   â”œâ”€â”€ sandbox/          # æ²™ç®±æ‰§è¡Œ
â”‚   â””â”€â”€ studio/           # å·¥ä½œå°åŠŸèƒ½
â”œâ”€â”€ db/                    # æ•°æ®åº“ç›¸å…³
â”‚   â”œâ”€â”€ database.py       # ä¸»æ•°æ®åº“
â”‚   â”œâ”€â”€ redis.py          # Redis
â”‚   â””â”€â”€ vector.py         # å‘é‡æ•°æ®åº“
â”œâ”€â”€ evaluation/            # è¯„ä¼°æ¨¡å—
â”œâ”€â”€ models/                # æ•°æ®æ¨¡å‹ (ORM)
â”œâ”€â”€ schemas/               # æ•°æ®æ¨¡å¼ (Pydantic)
â”œâ”€â”€ services/              # ä¸šåŠ¡æœåŠ¡å±‚
â”œâ”€â”€ tools/                 # å·¥å…·ç³»ç»Ÿ
â”œâ”€â”€ utils/                 # å·¥å…·å‡½æ•°
â””â”€â”€ workers/               # åå°ä»»åŠ¡
```

---

## äºŒã€æ•°æ®å±‚ç›®å½•å…³ç³»è¯¦è§£

### ğŸ“Š æ•°æ®å±‚ä¸‰å±‚æ¶æ„

é¡¹ç›®é‡‡ç”¨ç»å…¸çš„ä¸‰å±‚æ•°æ®æ¶æ„ï¼Œå„å±‚èŒè´£æ˜ç¡®ï¼Œç›¸äº’é…åˆï¼š

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    API å±‚ (FastAPI)                      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  schemas/  (Pydantic æ•°æ®éªŒè¯)                    â”‚  â”‚
â”‚  â”‚  - è¯·æ±‚/å“åº”æ•°æ®éªŒè¯                               â”‚  â”‚
â”‚  â”‚  - åºåˆ—åŒ–/ååºåˆ—åŒ–                                 â”‚  â”‚
â”‚  â”‚  - ä¸ç›´æ¥è®¿é—®æ•°æ®åº“                                 â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                          â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                 ä¸šåŠ¡é€»è¾‘å±‚ (Services)                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  models/  (SQLAlchemy ORM)                        â”‚  â”‚
â”‚  â”‚  - æ•°æ®åº“è¡¨ç»“æ„å®šä¹‰                                 â”‚  â”‚
â”‚  â”‚  - ORM å¯¹è±¡å…³ç³»æ˜ å°„                                 â”‚  â”‚
â”‚  â”‚  - æ•°æ®åº“æ“ä½œå°è£…                                   â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                          â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                 æ•°æ®è®¿é—®å±‚ (Database)                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  db/  (æ•°æ®åº“è¿æ¥ç®¡ç†)                              â”‚  â”‚
â”‚  â”‚  - database.py: PostgreSQL è¿æ¥                    â”‚  â”‚
â”‚  â”‚  - redis.py: Redis è¿æ¥                             â”‚  â”‚
â”‚  â”‚  - vector.py: å‘é‡æ•°æ®åº“è¿æ¥                        â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### ğŸ”— ç›®å½•å…³ç³»è¯¦ç»†è¯´æ˜

#### 1. **`db/` - æ•°æ®è®¿é—®å±‚ (Data Access Layer)**

**èŒè´£**: æä¾›æ•°æ®åº“è¿æ¥åŸºç¡€è®¾æ–½

| æ–‡ä»¶ | åŠŸèƒ½ | æŠ€æœ¯æ ˆ |
|------|------|--------|
| `database.py` | PostgreSQL ä¸»æ•°æ®åº“è¿æ¥ç®¡ç† | SQLAlchemy 2.0 (å¼‚æ­¥) |
| `redis.py` | Redis ç¼“å­˜/ä¼šè¯å­˜å‚¨è¿æ¥ | redis.asyncio |
| `vector.py` | å‘é‡æ•°æ®åº“è¿æ¥ (Qdrant/Chroma) | Qdrant Client / ChromaDB |

**å…³é”®åŠŸèƒ½**:
- æ•°æ®åº“å¼•æ“åˆå§‹åŒ– (`init_db()`)
- ä¼šè¯å·¥å‚ç®¡ç† (`get_session_factory()`)
- è¿æ¥æ± é…ç½®
- å¼‚æ­¥ä¼šè¯ä¸Šä¸‹æ–‡ç®¡ç†

**ä½¿ç”¨ç¤ºä¾‹**:
```python
from db.database import get_session, Base

# è·å–æ•°æ®åº“ä¼šè¯
async with get_session() as session:
    # æ‰§è¡Œæ•°æ®åº“æ“ä½œ
    pass
```

---

#### 2. **`models/` - ORM æ•°æ®æ¨¡å‹å±‚ (Object-Relational Mapping)**

**èŒè´£**: å®šä¹‰æ•°æ®åº“è¡¨ç»“æ„å’Œ ORM æ˜ å°„

**ç‰¹ç‚¹**:
- ç»§æ‰¿è‡ª `db.database.Base` (SQLAlchemy DeclarativeBase)
- ä½¿ç”¨ SQLAlchemy 2.0 ç±»å‹æ³¨è§£è¯­æ³• (`Mapped[T]`)
- å®šä¹‰è¡¨ç»“æ„ã€å­—æ®µç±»å‹ã€å…³ç³»æ˜ å°„
- æä¾› ORM å¯¹è±¡æ“ä½œæ–¹æ³•

**æ–‡ä»¶ç»“æ„**:
```
models/
â”œâ”€â”€ base.py          # æ¨¡å‹åŸºç±» (BaseModel, TimestampMixin)
â”œâ”€â”€ user.py          # ç”¨æˆ·æ¨¡å‹
â”œâ”€â”€ session.py       # ä¼šè¯æ¨¡å‹
â”œâ”€â”€ message.py       # æ¶ˆæ¯æ¨¡å‹
â”œâ”€â”€ agent.py         # Agent æ¨¡å‹
â”œâ”€â”€ memory.py        # è®°å¿†æ¨¡å‹
â””â”€â”€ workflow.py      # å·¥ä½œæµæ¨¡å‹
```

**ä½¿ç”¨ç¤ºä¾‹**:
```python
from models.user import User
from db.database import get_session

async with get_session() as session:
    # åˆ›å»ºç”¨æˆ·
    user = User(email="test@example.com", password_hash="...")
    session.add(user)
    await session.commit()
```

**ä¸ `db/` çš„å…³ç³»**:
- `models/base.py` å¯¼å…¥ `db.database.Base`
- æ‰€æœ‰æ¨¡å‹ç±»ç»§æ‰¿è‡ª `BaseModel`ï¼Œé—´æ¥ç»§æ‰¿ `Base`
- æ¨¡å‹é€šè¿‡ SQLAlchemy Session ä¸æ•°æ®åº“äº¤äº’

---

#### 3. **`schemas/` - æ•°æ®éªŒè¯å±‚ (Pydantic Schemas)**

**èŒè´£**: API è¯·æ±‚/å“åº”çš„æ•°æ®éªŒè¯å’Œåºåˆ—åŒ–

**ç‰¹ç‚¹**:
- ä½¿ç”¨ Pydantic v2 è¿›è¡Œæ•°æ®éªŒè¯
- **ä¸ç›´æ¥è®¿é—®æ•°æ®åº“**ï¼Œä»…ç”¨äºæ•°æ®éªŒè¯
- å®šä¹‰ API æ¥å£çš„è¾“å…¥/è¾“å‡ºæ ¼å¼
- æ”¯æŒæ•°æ®è½¬æ¢å’Œåºåˆ—åŒ–

**æ–‡ä»¶ç»“æ„**:
```
schemas/
â”œâ”€â”€ user.py          # ç”¨æˆ·ç›¸å…³ Schema
â”‚   â”œâ”€â”€ UserCreate   # æ³¨å†Œè¯·æ±‚
â”‚   â”œâ”€â”€ UserLogin    # ç™»å½•è¯·æ±‚
â”‚   â”œâ”€â”€ UserUpdate   # æ›´æ–°è¯·æ±‚
â”‚   â””â”€â”€ UserResponse # å“åº”æ•°æ®
â””â”€â”€ message.py       # æ¶ˆæ¯ç›¸å…³ Schema
    â”œâ”€â”€ ChatEvent
    â””â”€â”€ ToolCallData
```

**ä½¿ç”¨ç¤ºä¾‹**:
```python
from schemas.user import UserCreate, UserResponse
from fastapi import APIRouter

@router.post("/users", response_model=UserResponse)
async def create_user(user_data: UserCreate):
    # user_data å·²é€šè¿‡ Pydantic éªŒè¯
    # è½¬æ¢ä¸º ORM æ¨¡å‹
    user = User(email=user_data.email, ...)
    # ...
```

**ä¸ `models/` çš„å…³ç³»**:
- **å¯¹åº”å…³ç³»**: é€šå¸¸ä¸€ä¸ª `models/` æ¨¡å‹å¯¹åº”å¤šä¸ª `schemas/` Schema
  - `models.User` â†” `schemas.UserCreate`, `schemas.UserResponse`, `schemas.UserUpdate`
- **è½¬æ¢æµç¨‹**:
  ```
  API è¯·æ±‚ â†’ schemas.UserCreate (éªŒè¯)
         â†’ models.User (ORM å¯¹è±¡)
         â†’ æ•°æ®åº“æ“ä½œ
         â†’ models.User (ORM å¯¹è±¡)
         â†’ schemas.UserResponse (åºåˆ—åŒ–)
         â†’ API å“åº”
  ```

---

### ğŸ”„ æ•°æ®æµè½¬ç¤ºä¾‹

**å®Œæ•´çš„æ•°æ®æµè½¬è¿‡ç¨‹**:

```python
# 1. API å±‚æ¥æ”¶è¯·æ±‚
@router.post("/users", response_model=UserResponse)
async def create_user(
    user_data: UserCreate,  # â† schemas/ éªŒè¯è¾“å…¥
    session: AsyncSession = Depends(get_session)  # â† db/ æä¾›ä¼šè¯
):
    # 2. å°† Schema è½¬æ¢ä¸º ORM æ¨¡å‹
    user = User(  # â† models/ ORM å¯¹è±¡
        email=user_data.email,
        password_hash=hash_password(user_data.password),
        name=user_data.name
    )

    # 3. é€šè¿‡ Session ä¿å­˜åˆ°æ•°æ®åº“
    session.add(user)  # â† db/ æ•°æ®åº“æ“ä½œ
    await session.commit()

    # 4. å°† ORM æ¨¡å‹è½¬æ¢ä¸ºå“åº” Schema
    return UserResponse(  # â† schemas/ åºåˆ—åŒ–è¾“å‡º
        id=str(user.id),
        email=user.email,
        name=user.name,
        created_at=user.created_at
    )
```

---

### ğŸ“‹ ä¸‰å±‚èŒè´£å¯¹æ¯”

| ç»´åº¦ | `db/` | `models/` | `schemas/` |
|------|-------|-----------|------------|
| **å±‚çº§** | æ•°æ®è®¿é—®å±‚ | ORM æ¨¡å‹å±‚ | æ•°æ®éªŒè¯å±‚ |
| **æŠ€æœ¯** | SQLAlchemy Engine/Session | SQLAlchemy ORM | Pydantic |
| **èŒè´£** | è¿æ¥ç®¡ç†ã€ä¼šè¯ç®¡ç† | è¡¨ç»“æ„å®šä¹‰ã€ORM æ˜ å°„ | æ•°æ®éªŒè¯ã€åºåˆ—åŒ– |
| **æ•°æ®åº“** | âœ… ç›´æ¥æ“ä½œ | âœ… é€šè¿‡ ORM æ“ä½œ | âŒ ä¸è®¿é—®æ•°æ®åº“ |
| **API** | âŒ ä¸ç›´æ¥æš´éœ² | âš ï¸ å¯é€šè¿‡ Services æš´éœ² | âœ… ç›´æ¥ç”¨äº API |
| **ä¾èµ–å…³ç³»** | æ— ä¾èµ– | ä¾èµ– `db/` | ç‹¬ç«‹ï¼ˆå¯ä¾èµ– `models/` åšè½¬æ¢ï¼‰ |

---

### âœ… æœ€ä½³å®è·µ

1. **èŒè´£åˆ†ç¦»**
   - `db/`: åªè´Ÿè´£è¿æ¥ç®¡ç†ï¼Œä¸åŒ…å«ä¸šåŠ¡é€»è¾‘
   - `models/`: åªå®šä¹‰æ•°æ®ç»“æ„ï¼Œä¸åŒ…å«éªŒè¯é€»è¾‘
   - `schemas/`: åªè´Ÿè´£æ•°æ®éªŒè¯ï¼Œä¸è®¿é—®æ•°æ®åº“

2. **æ•°æ®è½¬æ¢**
   - API å±‚ä½¿ç”¨ `schemas/` è¿›è¡ŒéªŒè¯
   - Services å±‚ä½¿ç”¨ `models/` è¿›è¡Œæ•°æ®åº“æ“ä½œ
   - åœ¨ Services å±‚è¿›è¡Œ `schemas` â†” `models` è½¬æ¢

3. **ä¾èµ–æ–¹å‘**
   ```
   schemas/ (ç‹¬ç«‹)
        â†‘
   models/ (ä¾èµ– db/)
        â†‘
   db/ (åŸºç¡€è®¾æ–½)
   ```

---

## ä¸‰ã€é¢å‘æŠ½è±¡ç¼–ç¨‹ä¸è®¾è®¡å¹³è¡¡

### ğŸ¯ è®¾è®¡åŸåˆ™ï¼šé¢å‘æŠ½è±¡ï¼Œé¿å…è¿‡åº¦è®¾è®¡

é¡¹ç›®åœ¨**é¢å‘æŠ½è±¡ç¼–ç¨‹**å’Œ**å®ç”¨ä¸»ä¹‰**ä¹‹é—´å–å¾—äº†è‰¯å¥½å¹³è¡¡ã€‚ä»¥ä¸‹æ˜¯å½“å‰æŠ½è±¡è®¾è®¡çš„è¯„ä¼°ï¼š

---

### âœ… åˆç†çš„æŠ½è±¡è®¾è®¡

#### 1. **å‘é‡æ•°æ®åº“æŠ½è±¡** (`db/vector.py`)

**è®¾è®¡**: ä½¿ç”¨ `ABC` æŠ½è±¡åŸºç±»

```python
class VectorStore(ABC):
    """å‘é‡å­˜å‚¨æŠ½è±¡åŸºç±»"""

    @abstractmethod
    async def search(...) -> list[dict]:
        ...
```

**å®ç°**: `QdrantStore`, `ChromaStore`

**ä¸ºä»€ä¹ˆåˆç†**:
- âœ… **å¤šå®ç°éœ€æ±‚**: ç”Ÿäº§ç¯å¢ƒç”¨ Qdrantï¼Œå¼€å‘ç¯å¢ƒç”¨ Chroma
- âœ… **åˆ‡æ¢æˆæœ¬ä½**: é€šè¿‡é…ç½®åˆ‡æ¢ï¼Œæ— éœ€ä¿®æ”¹ä¸šåŠ¡ä»£ç 
- âœ… **æ¥å£ç¨³å®š**: å‘é‡æ•°æ®åº“æ“ä½œæ¥å£ç›¸å¯¹ç¨³å®š

**æŠ½è±¡æ”¶ç›Š**: â­â­â­â­â­ (é«˜)

---

#### 2. **å·¥å…·ç³»ç»ŸæŠ½è±¡** (`tools/base.py` + `core/types.py`)

**è®¾è®¡**: åŒé‡æŠ½è±¡
- `BaseTool(ABC)` - æŠ½è±¡åŸºç±»ï¼Œæä¾›é»˜è®¤å®ç°
- `ToolProtocol(Protocol)` - åè®®æ¥å£ï¼Œæ”¯æŒé¸­å­ç±»å‹

```python
# æŠ½è±¡åŸºç±»
class BaseTool(ABC):
    @abstractmethod
    async def execute(self, **kwargs) -> ToolResult:
        ...

# åè®®æ¥å£
class ToolProtocol(Protocol):
    async def execute(self, **kwargs: Any) -> ToolResult:
        ...
```

**ä¸ºä»€ä¹ˆåˆç†**:
- âœ… **æ‰©å±•æ€§å¼º**: æ–°å·¥å…·åªéœ€ç»§æ‰¿ `BaseTool` æˆ–å®ç° `ToolProtocol`
- âœ… **ç±»å‹å®‰å…¨**: Protocol æä¾›ç±»å‹æ£€æŸ¥
- âœ… **çµæ´»æ€§**: æ”¯æŒç»§æ‰¿å’Œç»„åˆä¸¤ç§æ–¹å¼

**æŠ½è±¡æ”¶ç›Š**: â­â­â­â­â­ (é«˜)

---

#### 3. **æ²™ç®±æ‰§è¡Œå™¨æŠ½è±¡** (`core/sandbox/executor.py`)

**è®¾è®¡**: `SandboxExecutor(ABC)`

**å®ç°**: `DockerExecutor` (æœªæ¥å¯æ‰©å±• `E2BExecutor`, `LocalExecutor`)

**ä¸ºä»€ä¹ˆåˆç†**:
- âœ… **å¤šç¯å¢ƒæ”¯æŒ**: å¼€å‘/æµ‹è¯•/ç”Ÿäº§å¯èƒ½éœ€è¦ä¸åŒçš„æ‰§è¡Œç¯å¢ƒ
- âœ… **å®‰å…¨éš”ç¦»**: ä¸åŒå®ç°æä¾›ä¸åŒçº§åˆ«çš„éš”ç¦»
- âœ… **æµ‹è¯•å‹å¥½**: å¯ä»¥åˆ›å»º Mock å®ç°ç”¨äºæµ‹è¯•

**æŠ½è±¡æ”¶ç›Š**: â­â­â­â­ (ä¸­é«˜)

---

#### 4. **æ¨ç†æ¨¡å¼æŠ½è±¡** (`core/reasoning/base.py`)

**è®¾è®¡**: `BaseReasoningMode(ABC)`

**å®ç°**: `ReActMode`, `PlanActMode`, `CoTMode` ç­‰

**ä¸ºä»€ä¹ˆåˆç†**:
- âœ… **ç­–ç•¥æ¨¡å¼**: ä¸åŒä»»åŠ¡éœ€è¦ä¸åŒçš„æ¨ç†ç­–ç•¥
- âœ… **å¯æ’æ‹”**: è¿è¡Œæ—¶åˆ‡æ¢æ¨ç†æ¨¡å¼
- âœ… **æ‰©å±•æ€§**: æ˜“äºæ·»åŠ æ–°çš„æ¨ç†æ¨¡å¼

**æŠ½è±¡æ”¶ç›Š**: â­â­â­â­â­ (é«˜)

---

### âš ï¸ é€‚åº¦æŠ½è±¡ï¼ˆé¿å…è¿‡åº¦è®¾è®¡ï¼‰

#### 1. **æ•°æ®è®¿é—®å±‚** (`db/` + `models/`)

**å½“å‰è®¾è®¡**: ç›´æ¥ä½¿ç”¨ SQLAlchemy ORMï¼Œ**æ²¡æœ‰** Repository æ¨¡å¼

```python
# å½“å‰æ–¹å¼ï¼šç›´æ¥ä½¿ç”¨ ORM
async with get_session() as session:
    user = await session.get(User, user_id)
    user.name = "New Name"
    await session.commit()
```

**ä¸ºä»€ä¹ˆåˆç†**:
- âœ… **SQLAlchemy å·²è¶³å¤ŸæŠ½è±¡**: ORM æœ¬èº«å°±æ˜¯å¯¹æ•°æ®åº“çš„æŠ½è±¡
- âœ… **é¿å…é¢å¤–å±‚æ¬¡**: Repository æ¨¡å¼ä¼šå¢åŠ ä¸€å±‚é—´æ¥æ€§ï¼Œæ”¶ç›Šæœ‰é™
- âœ… **FastAPI æœ€ä½³å®è·µ**: ç›´æ¥ä½¿ç”¨ Session æ˜¯ FastAPI ç¤¾åŒºæ¨èçš„æ–¹å¼
- âœ… **ç®€å•ç›´æ¥**: å¯¹äºå¤§å¤šæ•° CRUD æ“ä½œï¼ŒORM å·²ç»è¶³å¤Ÿ

**å¦‚æœæ·»åŠ  Repository ä¼šæ€æ ·**:
```python
# è¿‡åº¦è®¾è®¡ç¤ºä¾‹ï¼ˆä¸æ¨èï¼‰
class UserRepository:
    async def get_by_id(self, id: str) -> User:
        async with get_session() as session:
            return await session.get(User, id)

    async def update(self, user: User) -> User:
        async with get_session() as session:
            session.add(user)
            await session.commit()
            return user
```

**é—®é¢˜**:
- âŒ **é¢å¤–æŠ½è±¡å±‚**: æ²¡æœ‰å¸¦æ¥å®é™…ä»·å€¼
- âŒ **å¢åŠ å¤æ‚åº¦**: éœ€è¦ç»´æŠ¤ Repository ç±»
- âŒ **æ€§èƒ½å¼€é”€**: é¢å¤–çš„å‡½æ•°è°ƒç”¨
- âŒ **çµæ´»æ€§é™ä½**: ORM çš„é«˜çº§ç‰¹æ€§ï¼ˆå¦‚ `selectinload`ï¼‰éš¾ä»¥ä½¿ç”¨

**ä½•æ—¶éœ€è¦ Repository**:
- å¤æ‚çš„æŸ¥è¯¢é€»è¾‘éœ€è¦å¤ç”¨
- éœ€è¦æ”¯æŒå¤šç§æ•°æ®æºï¼ˆSQL + NoSQLï¼‰
- éœ€è¦ç¼“å­˜å±‚æŠ½è±¡
- å›¢é˜Ÿè§„æ¨¡å¤§ï¼Œéœ€è¦ç»Ÿä¸€æ•°æ®è®¿é—®æ¥å£

**å½“å‰é¡¹ç›®**: ä¸éœ€è¦ âŒ

---

#### 2. **LLM Gateway** (`core/llm/gateway.py`)

**å½“å‰è®¾è®¡**: ç›´æ¥å®ç° `LLMGateway` ç±»ï¼Œä½¿ç”¨ LiteLLM ä½œä¸ºç»Ÿä¸€æ¥å£

**ä¸ºä»€ä¹ˆåˆç†**:
- âœ… **LiteLLM å·²æä¾›æŠ½è±¡**: ç»Ÿä¸€äº†å¤šæ¨¡å‹æ¥å£
- âœ… **å•ä¸€å®ç°**: ç›®å‰åªéœ€è¦ä¸€ä¸ªå®ç°
- âœ… **é…ç½®é©±åŠ¨**: é€šè¿‡é…ç½®åˆ‡æ¢æ¨¡å‹ï¼Œæ— éœ€ä»£ç å˜æ›´

**ä½•æ—¶éœ€è¦æŠ½è±¡**:
- éœ€è¦æ”¯æŒå¤šä¸ª LLM æä¾›å•†ï¼ˆOpenAI + Anthropic + è‡ªå»ºï¼‰
- éœ€è¦å®ç°å¤æ‚çš„è·¯ç”±é€»è¾‘
- éœ€è¦ A/B æµ‹è¯•ä¸åŒå®ç°

**å½“å‰é¡¹ç›®**: æœªæ¥å¯è€ƒè™‘ âš ï¸

---

### ğŸ“Š æŠ½è±¡è®¾è®¡è¯„ä¼°çŸ©é˜µ

| æ¨¡å— | æŠ½è±¡ç±»å‹ | å®ç°æ•°é‡ | åˆ‡æ¢é¢‘ç‡ | æŠ½è±¡æ”¶ç›Š | å¤æ‚åº¦æˆæœ¬ | è¯„ä¼° |
|------|---------|---------|---------|---------|-----------|------|
| **VectorStore** | ABC | 2 (Qdrant/Chroma) | ä½ | â­â­â­â­â­ | ä½ | âœ… åˆç† |
| **BaseTool** | ABC + Protocol | 10+ | é«˜ | â­â­â­â­â­ | ä½ | âœ… åˆç† |
| **SandboxExecutor** | ABC | 1 (Docker) | ä½ | â­â­â­â­ | ä¸­ | âœ… åˆç† |
| **BaseReasoningMode** | ABC | 5+ | ä¸­ | â­â­â­â­â­ | ä½ | âœ… åˆç† |
| **CheckpointStorage** | ABC | 1 | ä½ | â­â­â­ | ä¸­ | âš ï¸ é€‚åº¦ |
| **Repository Pattern** | - | 0 | - | â­ | é«˜ | âŒ è¿‡åº¦è®¾è®¡ |
| **LLM Gateway** | - | 1 | ä½ | â­â­ | ä¸­ | âœ… å½“å‰åˆç† |

---

### ğŸ“ è®¾è®¡åŸåˆ™æ€»ç»“

#### âœ… åº”è¯¥æŠ½è±¡çš„åœºæ™¯

1. **å¤šå®ç°éœ€æ±‚**
   - éœ€è¦æ”¯æŒå¤šç§å®ç°ï¼ˆå¦‚å‘é‡æ•°æ®åº“ï¼‰
   - å®ç°ä¹‹é—´å¯ä»¥äº’æ¢

2. **ç­–ç•¥æ¨¡å¼**
   - è¿è¡Œæ—¶éœ€è¦åˆ‡æ¢ç­–ç•¥ï¼ˆå¦‚æ¨ç†æ¨¡å¼ï¼‰
   - ç®—æ³•/è¡Œä¸ºéœ€è¦å¯æ’æ‹”

3. **æµ‹è¯•å‹å¥½**
   - éœ€è¦ Mock å®ç°è¿›è¡Œå•å…ƒæµ‹è¯•
   - éœ€è¦éš”ç¦»å¤–éƒ¨ä¾èµ–

4. **æ‰©å±•ç‚¹æ˜ç¡®**
   - æœªæ¥ç¡®å®šä¼šæœ‰æ–°å®ç°
   - æ¥å£ç›¸å¯¹ç¨³å®š

#### âŒ é¿å…è¿‡åº¦æŠ½è±¡çš„åœºæ™¯

1. **å•ä¸€å®ç°**
   - åªæœ‰ä¸€ä¸ªå®ç°ï¼Œä¸”æœªæ¥ä¸ä¼šå˜åŒ–
   - è¿‡æ—©æŠ½è±¡ï¼ˆYAGNI åŸåˆ™ï¼‰

2. **æ¡†æ¶å·²æä¾›æŠ½è±¡**
   - SQLAlchemy å·²æŠ½è±¡æ•°æ®åº“
   - LiteLLM å·²æŠ½è±¡å¤šæ¨¡å‹

3. **å¢åŠ å¤æ‚åº¦æ— æ”¶ç›Š**
   - Repository æ¨¡å¼åœ¨ç®€å• CRUD åœºæ™¯
   - é¢å¤–çš„æŠ½è±¡å±‚æ²¡æœ‰å®é™…ä»·å€¼

4. **æ€§èƒ½æ•æ„Ÿ**
   - æŠ½è±¡å±‚å¸¦æ¥æ€§èƒ½å¼€é”€
   - ç›´æ¥è°ƒç”¨æ›´é«˜æ•ˆ

---

### ğŸ”§ å½“å‰é¡¹ç›®çš„æŠ½è±¡ç­–ç•¥

#### å·²å®ç°çš„æŠ½è±¡ï¼ˆä¿æŒï¼‰

```python
# âœ… å‘é‡æ•°æ®åº“æŠ½è±¡
VectorStore (ABC)
  â”œâ”€â”€ QdrantStore
  â””â”€â”€ ChromaStore

# âœ… å·¥å…·ç³»ç»ŸæŠ½è±¡
BaseTool (ABC) + ToolProtocol (Protocol)
  â”œâ”€â”€ FileReadTool
  â”œâ”€â”€ CodeSearchTool
  â””â”€â”€ ...

# âœ… æ¨ç†æ¨¡å¼æŠ½è±¡
BaseReasoningMode (ABC)
  â”œâ”€â”€ ReActMode
  â”œâ”€â”€ PlanActMode
  â””â”€â”€ ...

# âœ… æ²™ç®±æ‰§è¡Œå™¨æŠ½è±¡
SandboxExecutor (ABC)
  â””â”€â”€ DockerExecutor
```

#### é€‚åº¦æŠ½è±¡ï¼ˆå½“å‰ä¸æŠ½è±¡ï¼‰

```python
# âœ… æ•°æ®è®¿é—®ï¼šç›´æ¥ä½¿ç”¨ ORM
# ä¸å¼•å…¥ Repository æ¨¡å¼ï¼ˆé¿å…è¿‡åº¦è®¾è®¡ï¼‰

# âœ… LLM Gatewayï¼šç›´æ¥å®ç°
# ä½¿ç”¨ LiteLLM ç»Ÿä¸€æ¥å£ï¼Œæœªæ¥éœ€è¦æ—¶å†æŠ½è±¡
```

#### æœªæ¥å¯è€ƒè™‘çš„æŠ½è±¡

```python
# âš ï¸ å¦‚æœæ”¯æŒå¤šä¸ª LLM æä¾›å•†
class LLMProvider(ABC):
    async def chat(...) -> ...

# âš ï¸ å¦‚æœæ”¯æŒå¤šç§ç¼“å­˜åç«¯
class CacheBackend(ABC):
    async def get(...) -> ...
    async def set(...) -> ...
```

---

### ğŸ“ æœ€ä½³å®è·µå»ºè®®

1. **éµå¾ª YAGNI åŸåˆ™**
   - ä¸è¦ä¸ºæœªæ¥å¯èƒ½çš„éœ€æ±‚æå‰æŠ½è±¡
   - å½“éœ€è¦ç¬¬äºŒä¸ªå®ç°æ—¶å†æŠ½è±¡

2. **ä½¿ç”¨ Protocol è€Œé ABCï¼ˆå½“å¯èƒ½æ—¶ï¼‰**
   ```python
   # æ›´çµæ´»ï¼šæ”¯æŒé¸­å­ç±»å‹
   class ToolProtocol(Protocol):
       async def execute(self) -> ToolResult: ...

   # æ›´ä¸¥æ ¼ï¼šå¿…é¡»ç»§æ‰¿
   class BaseTool(ABC):
       @abstractmethod
       async def execute(self) -> ToolResult: ...
   ```

3. **æŠ½è±¡æ¥å£è¦ç¨³å®š**
   - æ¥å£å˜æ›´æˆæœ¬é«˜
   - è®¾è®¡æ—¶è€ƒè™‘æ‰©å±•æ€§

4. **ä¿æŒç®€å•**
   - èƒ½ç›´æ¥å®ç°å°±ä¸è¦æŠ½è±¡
   - æŠ½è±¡è¦æœ‰æ˜ç¡®çš„æ”¶ç›Š

---

## å››ã€æ¶æ„ç¬¦åˆåº¦åˆ†æ

### âœ… å·²å®ç°çš„æ ¸å¿ƒæ¨¡å—

| æ¨¡å— | ä½ç½® | çŠ¶æ€ | è¯´æ˜ |
|------|------|------|------|
| **Agent Core (Main Loop)** | `core/engine/agent.py` | âœ… å®Œæ•´ | å®ç°äº†æ‰§è¡Œå¾ªç¯ã€ç»ˆæ­¢æ¡ä»¶ã€Human-in-the-Loop |
| **ä¸Šä¸‹æ–‡ç®¡ç†** | `core/context/manager.py` | âœ… å®Œæ•´ | Tokené¢„ç®—ã€ä¸Šä¸‹æ–‡ç»„è£… |
| **æ£€æŸ¥ç‚¹ç³»ç»Ÿ** | `core/engine/checkpointer.py` | âœ… å®Œæ•´ | çŠ¶æ€æŒä¹…åŒ–ã€æ¢å¤æœºåˆ¶ |
| **å·¥å…·ç³»ç»Ÿ** | `tools/` | âœ… å®Œæ•´ | å·¥å…·æ³¨å†Œã€æ‰§è¡Œ |
| **è®°å¿†ç³»ç»Ÿ** | `core/memory/` | âœ… å®Œæ•´ | è®°å¿†ç®¡ç†ã€æ£€ç´¢ |
| **æ¨¡å‹ç½‘å…³** | `core/llm/gateway.py` | âœ… å®Œæ•´ | å¤šæ¨¡å‹æ”¯æŒã€è·¯ç”± |
| **æ²™ç®±æ‰§è¡Œ** | `core/sandbox/executor.py` | âœ… å®Œæ•´ | ä»£ç éš”ç¦»æ‰§è¡Œ |

### âš ï¸ éƒ¨åˆ†å®ç°æˆ–ç¼ºå¤±çš„æ¨¡å—

| æ¨¡å— | æ¶æ„æ–‡æ¡£è¦æ±‚ | å½“å‰çŠ¶æ€ | å»ºè®® |
|------|------------|---------|------|
| **æ¨ç†æ¨¡å¼** | ReAct/Plan-Act/CoT/ToT/Reflect | âŒ ç¼ºå¤± | åº”åˆ›å»º `core/reasoning/` æ¨¡å— |
| **æ¡ä»¶è·¯ç”±** | ç¡®å®šæ€§è·¯ç”±é€»è¾‘ | âš ï¸ éƒ¨åˆ† | åœ¨ `agent.py` ä¸­ç®€å•å®ç°ï¼Œåº”ç‹¬ç«‹æ¨¡å— |
| **MCP åè®®æ”¯æŒ** | MCP æ‰©å±•å·¥å…· | âŒ ç¼ºå¤± | åº”åˆ›å»º `tools/mcp/` æ¨¡å— |
| **A2A è°ƒç”¨** | Agent-to-Agent | âŒ ç¼ºå¤± | åº”åˆ›å»º `core/a2a/` æ¨¡å— |
| **ç›‘æ§/å¯è§‚æµ‹æ€§** | è¿½è¸ªã€æŒ‡æ ‡ã€æ—¥å¿— | âš ï¸ éƒ¨åˆ† | åº”åˆ›å»º `core/observability/` æ¨¡å— |
| **ä¸­é—´ä»¶** | è¯·æ±‚å¤„ç†ä¸­é—´ä»¶ | âš ï¸ éƒ¨åˆ† | åº”åˆ›å»º `middleware/` ç›®å½• |

---

## äº”ã€è½¯ä»¶å·¥ç¨‹æœ€ä½³å®è·µè¯„ä¼°

### âœ… ä¼˜ç‚¹

1. **åˆ†å±‚æ¸…æ™°**
   - `api/` â†’ API è·¯ç”±å±‚
   - `services/` â†’ ä¸šåŠ¡é€»è¾‘å±‚
   - `core/` â†’ æ ¸å¿ƒåŠŸèƒ½å±‚
   - `models/` â†’ æ•°æ®æ¨¡å‹å±‚
   - `db/` â†’ æ•°æ®è®¿é—®å±‚

2. **å…³æ³¨ç‚¹åˆ†ç¦»**
   - å·¥å…·ç³»ç»Ÿç‹¬ç«‹ (`tools/`)
   - è®°å¿†ç³»ç»Ÿç‹¬ç«‹ (`core/memory/`)
   - è®¤è¯æˆæƒç‹¬ç«‹ (`core/auth/`)

3. **ç‰ˆæœ¬ç®¡ç†**
   - API ç‰ˆæœ¬åŒ– (`api/v1/`)

4. **æµ‹è¯•ç»“æ„**
   - `tests/` ç›®å½•ç»“æ„åˆç†
   - å•å…ƒæµ‹è¯•ã€é›†æˆæµ‹è¯•åˆ†ç¦»

### âš ï¸ éœ€è¦æ”¹è¿›çš„åœ°æ–¹

#### 1. **ç›®å½•ç»“æ„é—®é¢˜**

**é—®é¢˜**: å­˜åœ¨ç©ºç›®å½• `backend/backend/`
```bash
backend/
  â””â”€â”€ backend/  # âŒ ç©ºç›®å½•ï¼Œåº”åˆ é™¤
```

**å»ºè®®**: åˆ é™¤è¯¥ç›®å½•

---

#### 2. **ç¼ºå¤±çš„æ¶æ„æ¨¡å—**

**é—®é¢˜**: æ¶æ„æ–‡æ¡£ä¸­æåˆ°çš„éƒ¨åˆ†åŠŸèƒ½æœªç‹¬ç«‹æˆæ¨¡å—

**å»ºè®®ç›®å½•ç»“æ„**:
```
backend/
â”œâ”€â”€ core/
â”‚   â”œâ”€â”€ reasoning/          # æ¨ç†æ¨¡å¼æ¨¡å— (æ–°å¢)
â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â”œâ”€â”€ react.py       # ReAct æ¨¡å¼
â”‚   â”‚   â”œâ”€â”€ plan_act.py    # Plan-Act æ¨¡å¼
â”‚   â”‚   â”œâ”€â”€ cot.py         # Chain-of-Thought
â”‚   â”‚   â”œâ”€â”€ tot.py         # Tree-of-Thought
â”‚   â”‚   â””â”€â”€ reflect.py     # Reflect æ¨¡å¼
â”‚   â”œâ”€â”€ routing/           # æ¡ä»¶è·¯ç”±æ¨¡å— (æ–°å¢)
â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â””â”€â”€ router.py      # ç¡®å®šæ€§è·¯ç”±é€»è¾‘
â”‚   â”œâ”€â”€ a2a/               # Agent-to-Agent è°ƒç”¨ (æ–°å¢)
â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â”œâ”€â”€ client.py      # A2A å®¢æˆ·ç«¯
â”‚   â”‚   â””â”€â”€ registry.py    # Agent æ³¨å†Œè¡¨
â”‚   â””â”€â”€ observability/     # å¯è§‚æµ‹æ€§æ¨¡å— (æ–°å¢)
â”‚       â”œâ”€â”€ __init__.py
â”‚       â”œâ”€â”€ tracing.py     # åˆ†å¸ƒå¼è¿½è¸ª
â”‚       â”œâ”€â”€ metrics.py     # æŒ‡æ ‡æ”¶é›†
â”‚       â””â”€â”€ logging.py     # ç»“æ„åŒ–æ—¥å¿—
â”œâ”€â”€ middleware/            # ä¸­é—´ä»¶ç›®å½• (æ–°å¢)
â”‚   â”œâ”€â”€ __init__.py
â”‚   â”œâ”€â”€ auth.py            # è®¤è¯ä¸­é—´ä»¶
â”‚   â”œâ”€â”€ rate_limit.py      # é™æµä¸­é—´ä»¶
â”‚   â”œâ”€â”€ logging.py         # æ—¥å¿—ä¸­é—´ä»¶
â”‚   â””â”€â”€ error_handler.py  # é”™è¯¯å¤„ç†ä¸­é—´ä»¶
â””â”€â”€ tools/
    â””â”€â”€ mcp/               # MCP åè®®æ”¯æŒ (æ–°å¢)
        â”œâ”€â”€ __init__.py
        â”œâ”€â”€ client.py      # MCP å®¢æˆ·ç«¯
        â””â”€â”€ adapter.py    # MCP é€‚é…å™¨
```

---

#### 3. **é…ç½®ç®¡ç†åˆ†æ•£**

**å½“å‰**: é…ç½®åœ¨ `app/config.py` ä¸­é›†ä¸­ç®¡ç† âœ…

**å»ºè®®**: ä¿æŒç°çŠ¶ï¼Œä½†è€ƒè™‘æŒ‰æ¨¡å—æ‹†åˆ†é…ç½®ç±»

---

#### 4. **å¼‚å¸¸å¤„ç†**

**å½“å‰**: `exceptions.py` åœ¨æ ¹ç›®å½• âœ…

**å»ºè®®**: ä¿æŒç°çŠ¶ï¼Œæˆ–ç§»åŠ¨åˆ° `core/exceptions.py`

---

#### 5. **å·¥å…·å‡½æ•°ç»„ç»‡**

**å½“å‰**: `utils/` ç›®å½•åŒ…å«é€šç”¨å·¥å…· âœ…

**å»ºè®®**: è€ƒè™‘æŒ‰åŠŸèƒ½åˆ†ç±»ï¼š
```
utils/
â”œâ”€â”€ __init__.py
â”œâ”€â”€ crypto.py          # åŠ å¯†å·¥å…·
â”œâ”€â”€ logging.py         # æ—¥å¿—å·¥å…·
â”œâ”€â”€ tokens.py          # Token è®¡ç®—
â””â”€â”€ validation.py      # éªŒè¯å·¥å…· (å¯æ–°å¢)
```

---

## å…­ã€æ¨èçš„ç›®å½•ç»“æ„é‡æ„

### å®Œæ•´ç›®å½•ç»“æ„ (ç†æƒ³çŠ¶æ€)

```
backend/
â”œâ”€â”€ alembic/                    # æ•°æ®åº“è¿ç§»
â”‚   â”œâ”€â”€ versions/
â”‚   â”œâ”€â”€ env.py
â”‚   â””â”€â”€ script.py.mako
â”‚
â”œâ”€â”€ api/                        # API è·¯ç”±å±‚
â”‚   â”œâ”€â”€ v1/                     # API v1
â”‚   â”‚   â”œâ”€â”€ agent.py
â”‚   â”‚   â”œâ”€â”€ chat.py
â”‚   â”‚   â”œâ”€â”€ session.py
â”‚   â”‚   â”œâ”€â”€ tool.py
â”‚   â”‚   â””â”€â”€ ...
â”‚   â”œâ”€â”€ deps.py                 # ä¾èµ–æ³¨å…¥
â”‚   â”œâ”€â”€ errors.py               # API é”™è¯¯å¤„ç†
â”‚   â””â”€â”€ router.py               # è·¯ç”±èšåˆ
â”‚
â”œâ”€â”€ app/                        # åº”ç”¨å…¥å£
â”‚   â”œâ”€â”€ config.py               # é…ç½®ç®¡ç†
â”‚   â”œâ”€â”€ main.py                 # FastAPI åº”ç”¨
â”‚   â””â”€â”€ lifespan.py             # ç”Ÿå‘½å‘¨æœŸç®¡ç† (å¯æ‹†åˆ†)
â”‚
â”œâ”€â”€ core/                       # æ ¸å¿ƒä¸šåŠ¡é€»è¾‘
â”‚   â”œâ”€â”€ agent/                  # Agent æ ¸å¿ƒ (å¯é‡å‘½å engine/)
â”‚   â”‚   â”œâ”€â”€ engine.py           # Main Loop
â”‚   â”‚   â”œâ”€â”€ checkpointer.py     # æ£€æŸ¥ç‚¹
â”‚   â”‚   â””â”€â”€ termination.py      # ç»ˆæ­¢æ¡ä»¶ (å¯æ‹†åˆ†)
â”‚   â”‚
â”‚   â”œâ”€â”€ context/                # ä¸Šä¸‹æ–‡ç®¡ç†
â”‚   â”‚   â”œâ”€â”€ manager.py
â”‚   â”‚   â””â”€â”€ compression.py      # ä¸Šä¸‹æ–‡å‹ç¼© (å¯æ‹†åˆ†)
â”‚   â”‚
â”‚   â”œâ”€â”€ memory/                  # è®°å¿†ç³»ç»Ÿ
â”‚   â”‚   â”œâ”€â”€ manager.py
â”‚   â”‚   â”œâ”€â”€ retriever.py
â”‚   â”‚   â””â”€â”€ storage.py           # å­˜å‚¨æŠ½è±¡ (å¯æ‹†åˆ†)
â”‚   â”‚
â”‚   â”œâ”€â”€ llm/                     # LLM ç½‘å…³
â”‚   â”‚   â”œâ”€â”€ gateway.py
â”‚   â”‚   â”œâ”€â”€ providers.py
â”‚   â”‚   â””â”€â”€ router.py            # æ¨¡å‹è·¯ç”± (å¯æ‹†åˆ†)
â”‚   â”‚
â”‚   â”œâ”€â”€ tools/                   # å·¥å…·æ‰§è¡Œ (å¯é‡å‘½å)
â”‚   â”‚   â”œâ”€â”€ executor.py          # å·¥å…·æ‰§è¡Œå™¨
â”‚   â”‚   â”œâ”€â”€ registry.py          # å·¥å…·æ³¨å†Œè¡¨
â”‚   â”‚   â””â”€â”€ sandbox.py           # æ²™ç®±æ‰§è¡Œ (æˆ–ä¿ç•™åœ¨ core/sandbox/)
â”‚   â”‚
â”‚   â”œâ”€â”€ reasoning/               # æ¨ç†æ¨¡å¼ (æ–°å¢)
â”‚   â”‚   â”œâ”€â”€ base.py              # åŸºç±»
â”‚   â”‚   â”œâ”€â”€ react.py
â”‚   â”‚   â”œâ”€â”€ plan_act.py
â”‚   â”‚   â””â”€â”€ ...
â”‚   â”‚
â”‚   â”œâ”€â”€ routing/                 # æ¡ä»¶è·¯ç”± (æ–°å¢)
â”‚   â”‚   â””â”€â”€ router.py
â”‚   â”‚
â”‚   â”œâ”€â”€ a2a/                     # Agent-to-Agent (æ–°å¢)
â”‚   â”‚   â”œâ”€â”€ client.py
â”‚   â”‚   â””â”€â”€ registry.py
â”‚   â”‚
â”‚   â”œâ”€â”€ observability/           # å¯è§‚æµ‹æ€§ (æ–°å¢)
â”‚   â”‚   â”œâ”€â”€ tracing.py
â”‚   â”‚   â”œâ”€â”€ metrics.py
â”‚   â”‚   â””â”€â”€ logging.py
â”‚   â”‚
â”‚   â”œâ”€â”€ auth/                    # è®¤è¯æˆæƒ
â”‚   â”‚   â”œâ”€â”€ jwt.py
â”‚   â”‚   â”œâ”€â”€ password.py
â”‚   â”‚   â””â”€â”€ rbac.py
â”‚   â”‚
â”‚   â”œâ”€â”€ sandbox/                 # æ²™ç®±æ‰§è¡Œ
â”‚   â”‚   â””â”€â”€ executor.py
â”‚   â”‚
â”‚   â”œâ”€â”€ lsp/                     # LSP é›†æˆ
â”‚   â”‚   â”œâ”€â”€ proxy.py
â”‚   â”‚   â”œâ”€â”€ pyright.py
â”‚   â”‚   â””â”€â”€ ruff.py
â”‚   â”‚
â”‚   â”œâ”€â”€ quality/                 # ä»£ç è´¨é‡
â”‚   â”‚   â”œâ”€â”€ validator.py
â”‚   â”‚   â”œâ”€â”€ fixer.py
â”‚   â”‚   â””â”€â”€ ...
â”‚   â”‚
â”‚   â”œâ”€â”€ studio/                  # å·¥ä½œå°åŠŸèƒ½
â”‚   â”‚   â”œâ”€â”€ workflow.py
â”‚   â”‚   â”œâ”€â”€ codegen.py
â”‚   â”‚   â””â”€â”€ parser.py
â”‚   â”‚
â”‚   â””â”€â”€ types.py                 # ç±»å‹å®šä¹‰
â”‚
â”œâ”€â”€ db/                          # æ•°æ®è®¿é—®å±‚
â”‚   â”œâ”€â”€ database.py              # PostgreSQL
â”‚   â”œâ”€â”€ redis.py                 # Redis
â”‚   â”œâ”€â”€ vector.py                # å‘é‡æ•°æ®åº“
â”‚   â””â”€â”€ migrations/              # è¿ç§»è„šæœ¬ (å¯é€‰)
â”‚
â”œâ”€â”€ middleware/                  # ä¸­é—´ä»¶ (æ–°å¢)
â”‚   â”œâ”€â”€ auth.py                  # è®¤è¯
â”‚   â”œâ”€â”€ rate_limit.py            # é™æµ
â”‚   â”œâ”€â”€ logging.py               # æ—¥å¿—
â”‚   â””â”€â”€ error_handler.py         # é”™è¯¯å¤„ç†
â”‚
â”œâ”€â”€ models/                      # ORM æ¨¡å‹
â”‚   â”œâ”€â”€ base.py
â”‚   â”œâ”€â”€ user.py
â”‚   â”œâ”€â”€ session.py
â”‚   â”œâ”€â”€ message.py
â”‚   â”œâ”€â”€ agent.py
â”‚   â”œâ”€â”€ memory.py
â”‚   â””â”€â”€ workflow.py
â”‚
â”œâ”€â”€ schemas/                     # Pydantic æ¨¡å¼
â”‚   â”œâ”€â”€ user.py
â”‚   â”œâ”€â”€ message.py
â”‚   â””â”€â”€ ...
â”‚
â”œâ”€â”€ services/                    # ä¸šåŠ¡æœåŠ¡å±‚
â”‚   â”œâ”€â”€ agent.py
â”‚   â”œâ”€â”€ chat.py
â”‚   â”œâ”€â”€ session.py
â”‚   â”œâ”€â”€ memory.py
â”‚   â”œâ”€â”€ checkpoint.py
â”‚   â””â”€â”€ user.py
â”‚
â”œâ”€â”€ tools/                       # å·¥å…·å®ç°
â”‚   â”œâ”€â”€ base.py                  # å·¥å…·åŸºç±»
â”‚   â”œâ”€â”€ registry.py              # å·¥å…·æ³¨å†Œ (æˆ–ç§»åˆ° core/tools/)
â”‚   â”œâ”€â”€ file_tools.py
â”‚   â”œâ”€â”€ code_tools.py
â”‚   â”œâ”€â”€ search_tools.py
â”‚   â””â”€â”€ mcp/                     # MCP åè®®æ”¯æŒ (æ–°å¢)
â”‚       â”œâ”€â”€ client.py
â”‚       â””â”€â”€ adapter.py
â”‚
â”œâ”€â”€ utils/                       # å·¥å…·å‡½æ•°
â”‚   â”œâ”€â”€ crypto.py
â”‚   â”œâ”€â”€ logging.py
â”‚   â”œâ”€â”€ tokens.py
â”‚   â””â”€â”€ validation.py            # éªŒè¯å·¥å…· (å¯æ–°å¢)
â”‚
â”œâ”€â”€ workers/                     # åå°ä»»åŠ¡
â”‚   â”œâ”€â”€ celery_app.py
â”‚   â””â”€â”€ tasks.py
â”‚
â”œâ”€â”€ evaluation/                  # è¯„ä¼°æ¨¡å—
â”‚   â”œâ”€â”€ benchmarks/
â”‚   â”œâ”€â”€ task_completion.py
â”‚   â””â”€â”€ ...
â”‚
â”œâ”€â”€ tests/                       # æµ‹è¯•
â”‚   â”œâ”€â”€ unit/
â”‚   â”œâ”€â”€ integration/
â”‚   â”œâ”€â”€ e2e/
â”‚   â””â”€â”€ fixtures/
â”‚
â”œâ”€â”€ scripts/                     # è„šæœ¬
â”‚   â””â”€â”€ ...
â”‚
â”œâ”€â”€ docs/                        # æ–‡æ¡£
â”‚   â””â”€â”€ ...
â”‚
â”œâ”€â”€ exceptions.py                # å¼‚å¸¸å®šä¹‰ (æˆ–ç§»åˆ° core/exceptions.py)
â”œâ”€â”€ requirements.txt
â”œâ”€â”€ pyproject.toml
â””â”€â”€ README.md
```

---

## ä¸ƒã€å…·ä½“æ”¹è¿›å»ºè®®

### ä¼˜å…ˆçº§ P0 (å¿…é¡»ä¿®å¤)

1. **åˆ é™¤ç©ºç›®å½•**
   ```bash
   rm -rf backend/backend/
   ```

2. **åˆ›å»ºç¼ºå¤±çš„æ ¸å¿ƒæ¨¡å—**
   - `core/reasoning/` - æ¨ç†æ¨¡å¼
   - `core/routing/` - æ¡ä»¶è·¯ç”±
   - `middleware/` - ä¸­é—´ä»¶

### ä¼˜å…ˆçº§ P1 (é‡è¦æ”¹è¿›)

3. **æ‹†åˆ†å¤§æ–‡ä»¶**
   - `core/engine/agent.py` å¯æ‹†åˆ†ï¼š
     - `core/agent/engine.py` - Main Loop
     - `core/agent/termination.py` - ç»ˆæ­¢æ¡ä»¶
     - `core/agent/hitl.py` - Human-in-the-Loop

4. **å®Œå–„å·¥å…·ç³»ç»Ÿ**
   - åˆ›å»º `tools/mcp/` æ”¯æŒ MCP åè®®
   - åˆ›å»º `core/a2a/` æ”¯æŒ Agent-to-Agent è°ƒç”¨

5. **å¯è§‚æµ‹æ€§æ¨¡å—**
   - åˆ›å»º `core/observability/` ç»Ÿä¸€ç®¡ç†è¿½è¸ªã€æŒ‡æ ‡ã€æ—¥å¿—

### ä¼˜å…ˆçº§ P2 (ä¼˜åŒ–æ”¹è¿›)

6. **é…ç½®ç®¡ç†ä¼˜åŒ–**
   - è€ƒè™‘æŒ‰æ¨¡å—æ‹†åˆ†é…ç½®ç±»

7. **æ–‡æ¡£å®Œå–„**
   - æ¯ä¸ªæ¨¡å—æ·»åŠ  `README.md`
   - API æ–‡æ¡£å®Œå–„

---

## å…­ã€ç¬¦åˆåº¦è¯„åˆ†

| è¯„ä¼°ç»´åº¦ | å¾—åˆ† | è¯´æ˜ |
|---------|------|------|
| **æ¶æ„ç¬¦åˆåº¦** | 85/100 | æ ¸å¿ƒåŠŸèƒ½å®Œæ•´ï¼Œéƒ¨åˆ†é«˜çº§åŠŸèƒ½ç¼ºå¤± |
| **ä»£ç ç»„ç»‡** | 90/100 | åˆ†å±‚æ¸…æ™°ï¼Œå…³æ³¨ç‚¹åˆ†ç¦»è‰¯å¥½ |
| **å¯ç»´æŠ¤æ€§** | 85/100 | ç»“æ„åˆç†ï¼Œä½†éƒ¨åˆ†æ¨¡å—è¿‡å¤§ |
| **å¯æ‰©å±•æ€§** | 80/100 | æ‰©å±•ç‚¹æ˜ç¡®ï¼Œä½†ç¼ºå°‘éƒ¨åˆ†æ¥å£æŠ½è±¡ |
| **æµ‹è¯•è¦†ç›–** | 75/100 | æµ‹è¯•ç»“æ„åˆç†ï¼Œä½†è¦†ç›–ç‡å¾…æå‡ |

**æ€»ä½“è¯„åˆ†**: **83/100** âœ…

---

## ä¸ƒã€æ€»ç»“

### âœ… ä¼˜ç‚¹

1. **æ ¸å¿ƒæ¶æ„å®Œæ•´**: Main Loopã€ä¸Šä¸‹æ–‡ç®¡ç†ã€æ£€æŸ¥ç‚¹ã€å·¥å…·ç³»ç»Ÿç­‰æ ¸å¿ƒåŠŸèƒ½éƒ½å·²å®ç°
2. **åˆ†å±‚æ¸…æ™°**: API â†’ Services â†’ Core çš„åˆ†å±‚ç»“æ„åˆç†
3. **å…³æ³¨ç‚¹åˆ†ç¦»**: å„æ¨¡å—èŒè´£æ˜ç¡®

### âš ï¸ éœ€è¦æ”¹è¿›

1. **ç¼ºå¤±é«˜çº§åŠŸèƒ½æ¨¡å—**: æ¨ç†æ¨¡å¼ã€æ¡ä»¶è·¯ç”±ã€A2A è°ƒç”¨ç­‰
2. **ç›®å½•ç»“æ„ä¼˜åŒ–**: éƒ¨åˆ†æ¨¡å—å¯è¿›ä¸€æ­¥æ‹†åˆ†
3. **å¯è§‚æµ‹æ€§**: éœ€è¦ç»Ÿä¸€çš„ç›‘æ§å’Œè¿½è¸ªæ¨¡å—

### ğŸ“‹ è¡ŒåŠ¨è®¡åˆ’

1. **ç«‹å³æ‰§è¡Œ** (P0):
   - åˆ é™¤ç©ºç›®å½•
   - åˆ›å»ºç¼ºå¤±çš„æ ¸å¿ƒæ¨¡å—ç›®å½•ç»“æ„

2. **è¿‘æœŸæ‰§è¡Œ** (P1):
   - å®ç°æ¨ç†æ¨¡å¼æ¨¡å—
   - å®Œå–„å·¥å…·ç³»ç»Ÿ (MCPã€A2A)
   - æ·»åŠ å¯è§‚æµ‹æ€§æ¨¡å—

3. **é•¿æœŸä¼˜åŒ–** (P2):
   - ä»£ç é‡æ„å’Œæ¨¡å—æ‹†åˆ†
   - å®Œå–„æ–‡æ¡£å’Œæµ‹è¯•

---

**ç»“è®º**: å½“å‰ç›®å½•ç»“æ„**åŸºæœ¬ç¬¦åˆ**æ¶æ„è®¾è®¡æ–‡æ¡£å’Œè½¯ä»¶å·¥ç¨‹æœ€ä½³å®è·µï¼Œä½†ä»æœ‰**æ”¹è¿›ç©ºé—´**ã€‚å»ºè®®æŒ‰ç…§ä¸Šè¿°ä¼˜å…ˆçº§é€æ­¥å®Œå–„ã€‚
