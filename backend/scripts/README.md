# Scripts ç›®å½•è¯´æ˜

æœ¬ç›®å½•ä»…ç”¨äºå­˜æ”¾**å·¥å…·è„šæœ¬**ï¼Œä¸åŒ…å«æµ‹è¯•ä»£ç ã€‚

## ç›®å½•è§„èŒƒ

### âœ… åº”è¯¥æ”¾åœ¨è¿™é‡Œçš„è„šæœ¬

- **éƒ¨ç½²å·¥å…·**: å¦‚ `run_sonar_scanner.py`ã€`check_sonar_env.py`
- **æ•°æ®åº“å·¥å…·**: å¦‚è¿ç§»è„šæœ¬ã€æ•°æ®å¯¼å…¥å¯¼å‡º
- **å¼€å‘å·¥å…·**: å¦‚ä»£ç ç”Ÿæˆè„šæœ¬ã€é…ç½®æ£€æŸ¥è„šæœ¬
- **CI/CD å·¥å…·**: å¦‚æ„å»ºè„šæœ¬ã€å‘å¸ƒè„šæœ¬

### âŒ ä¸åº”è¯¥æ”¾åœ¨è¿™é‡Œçš„è„šæœ¬

- **æµ‹è¯•è„šæœ¬**: åº”æ”¾åœ¨ `tests/` ç›®å½•
- **éªŒè¯è„šæœ¬**: åº”æ”¾åœ¨ `tests/` ç›®å½•æˆ–ä½œä¸º pytest æµ‹è¯•
- **ç¤ºä¾‹ä»£ç **: åº”æ”¾åœ¨ `examples/` ç›®å½•æˆ–æ–‡æ¡£ä¸­

## å½“å‰è„šæœ¬

- `check_sonar_env.py` - æ£€æŸ¥ SonarCloud ç¯å¢ƒé…ç½®
- `run_sonar_scanner.py` - è¿è¡Œ SonarCloud ä»£ç æ‰«æ
- `cleanup_sandbox_containers.py` - æ¸…ç†æ²™ç®±å®¹å™¨ï¼ˆsession-* å‰ç¼€çš„ Docker å®¹å™¨ï¼‰

## æ²™ç®±å®¹å™¨æ¸…ç†

`cleanup_sandbox_containers.py` ç”¨äºä¸€é”®æ¸…ç†æ‰€æœ‰æ²™ç®±å®¹å™¨ï¼ˆ`session-*` å‰ç¼€çš„ Docker å®¹å™¨ï¼‰ã€‚

### ä½¿ç”¨æ–¹æ³•

#### æ–¹å¼ä¸€ï¼šä½¿ç”¨ Makefileï¼ˆæ¨èï¼‰

```bash
# äº¤äº’å¼æ¸…ç†ï¼ˆä¼šè¯¢é—®ç¡®è®¤ï¼‰
make docker-cleanup-sandbox

# å¼ºåˆ¶æ¸…ç†æ‰€æœ‰å®¹å™¨ï¼ˆåŒ…æ‹¬è¿è¡Œä¸­çš„ï¼Œä¸è¯¢é—®ï¼‰
make docker-cleanup-sandbox-force

# é¢„è§ˆæ¨¡å¼ï¼ˆä»…æ˜¾ç¤ºè¦æ¸…ç†çš„å®¹å™¨ï¼Œä¸å®é™…åˆ é™¤ï¼‰
make docker-cleanup-sandbox-dry-run
```

#### æ–¹å¼äºŒï¼šç›´æ¥è¿è¡Œè„šæœ¬

```bash
# äº¤äº’å¼æ¸…ç†
python scripts/cleanup_sandbox_containers.py

# å¼ºåˆ¶æ¸…ç†ï¼ˆä¸è¯¢é—®ç¡®è®¤ï¼ŒåŒ…æ‹¬è¿è¡Œä¸­çš„å®¹å™¨ï¼‰
python scripts/cleanup_sandbox_containers.py --force

# é¢„è§ˆæ¨¡å¼ï¼ˆä»…æ˜¾ç¤ºï¼Œä¸å®é™…åˆ é™¤ï¼‰
python scripts/cleanup_sandbox_containers.py --dry-run

# ä»…æ¸…ç†å·²åœæ­¢çš„å®¹å™¨
python scripts/cleanup_sandbox_containers.py --stopped-only

# ä½¿ç”¨ SessionDockerExecutor çš„ç±»æ–¹æ³•æ¸…ç†
python scripts/cleanup_sandbox_containers.py --use-class-method
```

### å‚æ•°è¯´æ˜

- `--force`: å¼ºåˆ¶æ¸…ç†ï¼Œä¸è¯¢é—®ç¡®è®¤ï¼ŒåŒ…æ‹¬è¿è¡Œä¸­çš„å®¹å™¨
- `--all`: ç­‰åŒäº `--force`ï¼Œæ¸…ç†æ‰€æœ‰å®¹å™¨
- `--dry-run`: é¢„è§ˆæ¨¡å¼ï¼Œä»…æ˜¾ç¤ºè¦æ¸…ç†çš„å®¹å™¨ï¼Œä¸å®é™…åˆ é™¤
- `--stopped-only`: ä»…æ¸…ç†å·²åœæ­¢çš„å®¹å™¨
- `--use-class-method`: ä½¿ç”¨ `SessionDockerExecutor.cleanup_all_session_containers()` æ–¹æ³•æ¸…ç†

### ç¤ºä¾‹è¾“å‡º

```
================================================================================
æ²™ç®±å®¹å™¨æ¸…ç†å·¥å…·
================================================================================

ğŸ“‹ æ¸…ç†æ‰€æœ‰æ²™ç®±å®¹å™¨ (3 ä¸ª)

æ²™ç®±å®¹å™¨åˆ—è¡¨ (3 ä¸ª):
--------------------------------------------------------------------------------
  1. ğŸŸ¢ session-abc123def456                    [running   ]
  2. ğŸ”´ session-def456ghi789                    [exited    ]
  3. ğŸ”´ session-ghi789jkl012                    [exited    ]
--------------------------------------------------------------------------------

âš ï¸  è­¦å‘Š: å‘ç° 1 ä¸ªè¿è¡Œä¸­çš„å®¹å™¨:
    - session-abc123def456

ğŸ’¡ æç¤º: ä½¿ç”¨ --force æˆ– --all å¯ä»¥å¼ºåˆ¶åˆ é™¤è¿è¡Œä¸­çš„å®¹å™¨

â“ ç¡®è®¤åˆ é™¤ä»¥ä¸Šå®¹å™¨? [y/N]: y

ğŸ§¹ å¼€å§‹æ¸…ç†å®¹å™¨...

================================================================================
âœ… æˆåŠŸæ¸…ç† 3 ä¸ªå®¹å™¨:
    âœ“ session-abc123def456
    âœ“ session-def456ghi789
    âœ“ session-ghi789jkl012
================================================================================
```

## æµ‹è¯•ç›¸å…³

æ‰€æœ‰æµ‹è¯•ä»£ç åº”æ”¾åœ¨ `tests/` ç›®å½•ï¼š

- **å•å…ƒæµ‹è¯•**: `tests/unit/`
- **é›†æˆæµ‹è¯•**: `tests/integration/`
- **ç«¯åˆ°ç«¯æµ‹è¯•**: `tests/e2e/`

è¿è¡Œæµ‹è¯•ï¼š

```bash
# è¿è¡Œæ‰€æœ‰æµ‹è¯•
pytest

# è¿è¡Œå•å…ƒæµ‹è¯•
pytest tests/unit/

# è¿è¡Œé›†æˆæµ‹è¯•
pytest tests/integration/

# è¿è¡Œç‰¹å®šæµ‹è¯•
pytest tests/integration/test_llm_providers.py
```

## LLM æä¾›å•†æµ‹è¯•

LLM æä¾›å•†çš„æµ‹è¯•ä½äºï¼š

- **å•å…ƒæµ‹è¯•**: `tests/unit/core/test_llm_providers.py` - æµ‹è¯• Provider ç±»
- **é›†æˆæµ‹è¯•**: `tests/integration/test_llm_providers.py` - æµ‹è¯•å®é™… API è°ƒç”¨

å¦‚æœéœ€è¦æ‰‹åŠ¨æµ‹è¯• LLM æä¾›å•†è¿æ¥ï¼Œè¯·ä½¿ç”¨é›†æˆæµ‹è¯•ï¼š

```bash
# æµ‹è¯•æ‰€æœ‰é…ç½®çš„ LLM æä¾›å•†
pytest tests/integration/test_llm_providers.py -v

# æµ‹è¯•ç‰¹å®šæä¾›å•†ï¼ˆéœ€è¦é…ç½®å¯¹åº” API Keyï¼‰
pytest tests/integration/test_llm_providers.py::TestLLMProviders::test_deepseek_chat -v
```
