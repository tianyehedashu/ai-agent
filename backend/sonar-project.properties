# ==============================================================================
# SonarQube Configuration - Backend (Python)
# ==============================================================================
# 使用方式:
#   sonar-scanner -Dsonar.host.url=http://your-sonar-server:9000 -Dsonar.token=your-token
# ==============================================================================

# 项目标识
sonar.projectKey=ai-agent-backend
sonar.projectName=AI Agent Backend
sonar.projectVersion=0.1.0

# 源代码配置
sonar.sources=api,app,core,db,models,schemas,services,tools,utils
sonar.tests=tests
sonar.sourceEncoding=UTF-8

# Python 配置
sonar.language=py
sonar.python.version=3.11

# 排除文件/目录
sonar.exclusions=\
  **/__pycache__/**,\
  **/*.pyc,\
  **/migrations/**,\
  **/.venv/**,\
  **/node_modules/**,\
  **/dist/**,\
  **/*.md,\
  **/alembic/versions/**

# 测试排除
sonar.test.exclusions=\
  tests/**,\
  **/*_test.py,\
  **/test_*.py,\
  **/conftest.py

# 覆盖率报告 (pytest-cov 生成)
# 运行: pytest --cov --cov-report=xml:coverage.xml
sonar.python.coverage.reportPaths=coverage.xml

# 单元测试报告 (pytest 生成)
# 运行: pytest --junitxml=test-results.xml
sonar.python.xunit.reportPath=test-results.xml

# Pylint 报告 (可选)
# 运行: pylint --output-format=parseable api app core ... > pylint-report.txt
# sonar.python.pylint.reportPaths=pylint-report.txt

# Bandit 安全扫描报告 (可选)
# 运行: bandit -r . -f json -o bandit-report.json
# sonar.python.bandit.reportPaths=bandit-report.json

# ==============================================================================
# 质量门禁配置 (Quality Gate)
# ==============================================================================

# 代码重复率阈值
sonar.cpd.minimumTokens=50
sonar.cpd.minimumLines=5

# ==============================================================================
# 分支/PR 分析配置 (用于 CI)
# ==============================================================================

# 在 CI 中通过环境变量设置:
# sonar.branch.name=${BRANCH_NAME}
# sonar.pullrequest.key=${PR_NUMBER}
# sonar.pullrequest.branch=${PR_BRANCH}
# sonar.pullrequest.base=${PR_TARGET}
