# ðŸ”— å·¥ä½œå°ä¸Ž Agent ç³»ç»Ÿé›†æˆè®¾è®¡

> è¯¦ç»†è¯´æ˜Ž Agent Studioï¼ˆå·¥ä½œå°ï¼‰å¦‚ä½•ä¸Ž Agent Coreï¼ˆæ ¸å¿ƒå¼•æ“Žï¼‰æ— ç¼é›†æˆ

---

## ä¸€ã€é›†æˆæž¶æž„æ€»è§ˆ

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                              å®Œæ•´ç³»ç»Ÿæž¶æž„                                            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                                     â”‚
â”‚  â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•— â”‚
â”‚  â•‘                          Agent Studio (å·¥ä½œå°)                                 â•‘ â”‚
â”‚  â• â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•£ â”‚
â”‚  â•‘                                                                               â•‘ â”‚
â”‚  â•‘   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â•‘ â”‚
â”‚  â•‘   â”‚                         å·¥ä½œå°å‰ç«¯ (React + Vite)                      â”‚  â•‘ â”‚
â”‚  â•‘   â”‚   [å¯¹è¯åˆ›å»º] [å¯è§†åŒ–ç¼–æŽ’] [æç¤ºè¯ç¼–è¾‘] [è°ƒè¯•æµ‹è¯•] [éƒ¨ç½²ç®¡ç†]          â”‚  â•‘ â”‚
â”‚  â•‘   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â•‘ â”‚
â”‚  â•‘                                      â”‚ API                                    â•‘ â”‚
â”‚  â•‘                                      â–¼                                        â•‘ â”‚
â”‚  â•‘   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â•‘ â”‚
â”‚  â•‘   â”‚                    å·¥ä½œå°æœåŠ¡å±‚ (Studio Service)                       â”‚  â•‘ â”‚
â”‚  â•‘   â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚  â•‘ â”‚
â”‚  â•‘   â”‚   â”‚ å¯¹è¯åˆ›å»ºå™¨  â”‚  â”‚  ç¼–æŽ’å¼•æ“Ž   â”‚  â”‚ æµ‹è¯•è¿è¡Œå™¨  â”‚  â”‚ éƒ¨ç½²ç®¡ç†å™¨  â”‚ â”‚  â•‘ â”‚
â”‚  â•‘   â”‚   â”‚  Creator    â”‚  â”‚Orchestrator â”‚  â”‚ TestRunner  â”‚  â”‚  Deployer   â”‚ â”‚  â•‘ â”‚
â”‚  â•‘   â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚  â•‘ â”‚
â”‚  â•‘   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â•‘ â”‚
â”‚  â•‘                                      â”‚                                        â•‘ â”‚
â”‚  â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•ªâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• â”‚
â”‚                                         â”‚                                          â”‚
â”‚                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                     â”‚
â”‚                    â”‚  é…ç½®è½¬æ¢          â”‚  æ‰§è¡Œè°ƒç”¨          â”‚  æ•°æ®åŒæ­¥           â”‚
â”‚                    â–¼                    â–¼                    â–¼                     â”‚
â”‚  â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•— â”‚
â”‚  â•‘                           Agent Core (æ ¸å¿ƒå¼•æ“Ž)                                â•‘ â”‚
â”‚  â• â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•£ â”‚
â”‚  â•‘                                                                               â•‘ â”‚
â”‚  â•‘   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â•‘ â”‚
â”‚  â•‘   â”‚                     ä¸Šä¸‹æ–‡ç®¡ç†å™¨ (Context Manager)                   â”‚    â•‘ â”‚
â”‚  â•‘   â”‚      System Prompt â”‚ å¯¹è¯åŽ†å² â”‚ è®°å¿†å¬å›ž â”‚ å·¥å…·ç»“æžœ â”‚ ä»»åŠ¡çŠ¶æ€       â”‚    â•‘ â”‚
â”‚  â•‘   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â•‘ â”‚
â”‚  â•‘                                      â”‚                                        â•‘ â”‚
â”‚  â•‘   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â•‘ â”‚
â”‚  â•‘   â”‚                      æ‰§è¡Œå¾ªçŽ¯ (Main Loop)                            â”‚    â•‘ â”‚
â”‚  â•‘   â”‚              è¾“å…¥ â†’ æ€è€ƒ â†’ å†³ç­– â†’ è¡ŒåŠ¨ â†’ è¾“å‡º â†º                      â”‚    â•‘ â”‚
â”‚  â•‘   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â•‘ â”‚
â”‚  â•‘                                      â”‚                                        â•‘ â”‚
â”‚  â•‘           â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”            â•‘ â”‚
â”‚  â•‘           â–¼                          â–¼                          â–¼            â•‘ â”‚
â”‚  â•‘   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â•‘ â”‚
â”‚  â•‘   â”‚  å·¥å…·ç³»ç»Ÿ   â”‚          â”‚  è®°å¿†ç³»ç»Ÿ   â”‚          â”‚  æ¨¡åž‹ç½‘å…³   â”‚         â•‘ â”‚
â”‚  â•‘   â”‚   Tools     â”‚          â”‚   Memory    â”‚          â”‚ LLM Gateway â”‚         â•‘ â”‚
â”‚  â•‘   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â•‘ â”‚
â”‚  â•‘                                                                               â•‘ â”‚
â”‚  â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• â”‚
â”‚                                                                                     â”‚
â”‚  â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•— â”‚
â”‚  â•‘                              æ•°æ®å­˜å‚¨å±‚                                        â•‘ â”‚
â”‚  â•‘   [PostgreSQL]  [Redis]  [Qdrantå‘é‡åº“]  [MinIOå¯¹è±¡å­˜å‚¨]                      â•‘ â”‚
â”‚  â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• â”‚
â”‚                                                                                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## äºŒã€æ ¸å¿ƒé›†æˆç‚¹

### 2.1 é›†æˆç‚¹æ¦‚è§ˆ

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                               æ ¸å¿ƒé›†æˆç‚¹                                             â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚                            é›†æˆç‚¹ 1: é…ç½®è½¬æ¢                                â”‚   â”‚
â”‚  â”‚  å·¥ä½œå°å¯è§†åŒ–é…ç½® â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶ Agent Core æ‰§è¡Œé…ç½®                            â”‚   â”‚
â”‚  â”‚                                                                              â”‚   â”‚
â”‚  â”‚  â€¢ Workflow JSON (èŠ‚ç‚¹+è¾¹) â†’ AgentConfig                                     â”‚   â”‚
â”‚  â”‚  â€¢ èŠ‚ç‚¹é…ç½® â†’ System Prompt / Tools / Memory Config                         â”‚   â”‚
â”‚  â”‚  â€¢ æ‰§è¡Œé€»è¾‘ â†’ Main Loop æ‰§è¡Œç­–ç•¥                                            â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚                            é›†æˆç‚¹ 2: æ‰§è¡Œè°ƒç”¨                                â”‚   â”‚
â”‚  â”‚  å·¥ä½œå°å‘èµ·æ‰§è¡Œ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶ Agent Core å¤„ç†è¯·æ±‚                              â”‚   â”‚
â”‚  â”‚                                                                              â”‚   â”‚
â”‚  â”‚  â€¢ æµ‹è¯•è¿è¡Œ â†’ AgentEngine.run()                                             â”‚   â”‚
â”‚  â”‚  â€¢ å•æ­¥è°ƒè¯• â†’ AgentEngine.step()                                            â”‚   â”‚
â”‚  â”‚  â€¢ ç”Ÿäº§æ‰§è¡Œ â†’ éƒ¨ç½²çš„ Agent å®žä¾‹                                             â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚                            é›†æˆç‚¹ 3: äº‹ä»¶å›žä¼  (è¿è¡Œæ—¶çŠ¶æ€å¯è§†åŒ–)            â”‚   â”‚
â”‚  â”‚  Agent Core æ‰§è¡Œäº‹ä»¶ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶ å·¥ä½œå°æŽ¥æ”¶å±•ç¤º                              â”‚   â”‚
â”‚  â”‚                                                                              â”‚   â”‚
â”‚  â”‚  é€šè¿‡ ExecutionTracer + WebSocket å®žçŽ°å®žæ—¶çŠ¶æ€æŽ¨é€:                         â”‚   â”‚
â”‚  â”‚  â€¢ NODE_ENTER/EXIT â†’ èŠ‚ç‚¹æ‰§è¡Œé«˜äº® (è“è‰²è„‰å†²/ç»¿è‰²å®Œæˆ)                       â”‚   â”‚
â”‚  â”‚  â€¢ STATE_UPDATE â†’ çŠ¶æ€é¢æ¿å®žæ—¶æ›´æ–° (messages, context, iteration)           â”‚   â”‚
â”‚  â”‚  â€¢ LLM_STREAM_CHUNK â†’ LLM æµå¼è¾“å‡ºå®žæ—¶å±•ç¤º                                  â”‚   â”‚
â”‚  â”‚  â€¢ TOOL_CALL/RESULT â†’ å·¥å…·è°ƒç”¨å‚æ•°å’Œç»“æžœå±•ç¤º                                â”‚   â”‚
â”‚  â”‚  â€¢ Tokenç»Ÿè®¡ â†’ æˆæœ¬è®¡ç®—å±•ç¤º                                                 â”‚   â”‚
â”‚  â”‚  â€¢ çŠ¶æ€å¿«ç…§ â†’ Time Travel è°ƒè¯• (ç‚¹å‡»åŽ†å²äº‹ä»¶æŸ¥çœ‹å½“æ—¶çŠ¶æ€)                   â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚                            é›†æˆç‚¹ 4: æ•°æ®å…±äº«                                â”‚   â”‚
â”‚  â”‚  å…±äº«æ•°æ®æ¨¡åž‹å’Œå­˜å‚¨                                                          â”‚   â”‚
â”‚  â”‚                                                                              â”‚   â”‚
â”‚  â”‚  â€¢ Agenté…ç½® â†’ å…±ç”¨ agents è¡¨                                               â”‚   â”‚
â”‚  â”‚  â€¢ ä¼šè¯è®°å½• â†’ å…±ç”¨ sessions/messages è¡¨                                     â”‚   â”‚
â”‚  â”‚  â€¢ è®°å¿†æ•°æ® â†’ å…±ç”¨ memories è¡¨ + å‘é‡åº“                                     â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ä¸‰ã€Code-First æž¶æž„è®¾è®¡

### 3.1 æ ¸å¿ƒç†å¿µ

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                          Code-First æž¶æž„ç†å¿µ                                         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                                     â”‚
â”‚  æ ¸å¿ƒåŽŸåˆ™: åº•å±‚æ˜¯ Python ä»£ç ï¼ŒReact Flow åªæ˜¯ä»£ç çš„å¯è§†åŒ–æ¸²æŸ“                      â”‚
â”‚                                                                                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚                                                                              â”‚   â”‚
â”‚  â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        è§£æž         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”‚   â”‚
â”‚  â”‚   â”‚   Python ä»£ç       â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶ â”‚     å›¾ç»“æž„        â”‚          â”‚   â”‚
â”‚  â”‚   â”‚  (LangGraph DSL)   â”‚       Parser       â”‚ (nodes, edges)    â”‚          â”‚   â”‚
â”‚  â”‚   â”‚                    â”‚                    â”‚                   â”‚          â”‚   â”‚
â”‚  â”‚   â”‚  graph.add_node()  â”‚                    â”‚  {nodes: [...],   â”‚          â”‚   â”‚
â”‚  â”‚   â”‚  graph.add_edge()  â”‚                    â”‚   edges: [...]}   â”‚          â”‚   â”‚
â”‚  â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â”‚   â”‚
â”‚  â”‚            â–²                                         â”‚                     â”‚   â”‚
â”‚  â”‚            â”‚                                         â”‚ æ¸²æŸ“                â”‚   â”‚
â”‚  â”‚            â”‚ ä»£ç ç”Ÿæˆ                                â–¼                     â”‚   â”‚
â”‚  â”‚            â”‚ CodeGen                        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”‚   â”‚
â”‚  â”‚            â”‚                                â”‚   React Flow      â”‚          â”‚   â”‚
â”‚  â”‚            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ â”‚   å¯è§†åŒ–ç”»å¸ƒ      â”‚          â”‚   â”‚
â”‚  â”‚                                             â”‚                   â”‚          â”‚   â”‚
â”‚  â”‚                                             â”‚  [æ‹–æ‹½] [è¿žæŽ¥]    â”‚          â”‚   â”‚
â”‚  â”‚                                             â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â”‚   â”‚
â”‚  â”‚                                                                              â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                                     â”‚
â”‚  æ•°æ®æµå‘:                                                                          â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚
â”‚  1. ç”¨æˆ·å†™ä»£ç  â†’ è§£æž AST â†’ æå–å›¾ç»“æž„ â†’ React Flow æ¸²æŸ“                           â”‚
â”‚  2. ç”¨æˆ·æ‹–æ‹½ UI â†’ ç”Ÿæˆä»£ç å˜æ›´ â†’ æ›´æ–° Python æ–‡ä»¶                                  â”‚
â”‚  3. åŒå‘å®žæ—¶åŒæ­¥                                                                   â”‚
â”‚                                                                                     â”‚
â”‚  ä¸ºä»€ä¹ˆè¿™æ ·è®¾è®¡:                                                                    â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚
â”‚  âœ… å®šåˆ¶åŒ–æžé«˜ - ä»£ç å¯ä»¥è¡¨è¾¾ä»»æ„å¤æ‚é€»è¾‘                                          â”‚
â”‚  âœ… ç‰ˆæœ¬æŽ§åˆ¶å‹å¥½ - Python ä»£ç  Git diff æ¸…æ™°                                       â”‚
â”‚  âœ… å¤ç”¨æ€§å¼º - å‡½æ•°ã€ç±»ã€æ¨¡å—ã€åŒ…éƒ½å¯ä»¥å¤ç”¨                                        â”‚
â”‚  âœ… è°ƒè¯•æ–¹ä¾¿ - æ ‡å‡† Python è°ƒè¯•å™¨ã€IDE æ”¯æŒ                                        â”‚
â”‚  âœ… ä¸Ž LangGraph åŽŸç”Ÿå…¼å®¹ - ç›´æŽ¥æ‰§è¡Œï¼Œæ— éœ€è½¬æ¢                                     â”‚
â”‚  âœ… ä¸“ä¸šç”¨æˆ·å‹å¥½ - å¼€å‘è€…å¯ä»¥å®Œå…¨ç”¨ä»£ç                                             â”‚
â”‚                                                                                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 3.2 ä»£ç å³é…ç½®

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                           ä»£ç å³é…ç½® (Code as Config)                                â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                                     â”‚
â”‚  ä¼ ç»Ÿæ–¹å¼ (Visual-First):                     æˆ‘ä»¬çš„æ–¹å¼ (Code-First):              â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€         â”‚
â”‚                                                                                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”‚
â”‚  â”‚  UI æ‹–æ‹½            â”‚                      â”‚  # agent_research.py        â”‚       â”‚
â”‚  â”‚     â†“               â”‚                      â”‚                             â”‚       â”‚
â”‚  â”‚  JSON é…ç½®          â”‚                      â”‚  from langgraph.graph importâ”‚       â”‚
â”‚  â”‚     â†“               â”‚                      â”‚      StateGraph, END        â”‚       â”‚
â”‚  â”‚  è½¬æ¢å™¨ (Converter) â”‚                      â”‚                             â”‚       â”‚
â”‚  â”‚     â†“               â”‚                      â”‚  graph = StateGraph(State)  â”‚       â”‚
â”‚  â”‚  æ‰§è¡Œé…ç½®           â”‚                      â”‚  graph.add_node("search",   â”‚       â”‚
â”‚  â”‚     â†“               â”‚                      â”‚      search_web)            â”‚       â”‚
â”‚  â”‚  è¿è¡Œ               â”‚                      â”‚  graph.add_node("analyze",  â”‚       â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                      â”‚      analyze_results)       â”‚       â”‚
â”‚                                               â”‚  graph.add_edge("search",   â”‚       â”‚
â”‚  é—®é¢˜:                                        â”‚      "analyze")             â”‚       â”‚
â”‚  â€¢ JSON å¯è¯»æ€§å·®                              â”‚  graph.add_edge("analyze",  â”‚       â”‚
â”‚  â€¢ å¤æ‚é€»è¾‘éš¾ä»¥è¡¨è¾¾                           â”‚      END)                   â”‚       â”‚
â”‚  â€¢ éœ€è¦é¢å¤–è½¬æ¢å±‚                             â”‚                             â”‚       â”‚
â”‚  â€¢ è°ƒè¯•å›°éš¾                                   â”‚  # è¿™å°±æ˜¯æ‰§è¡Œé…ç½®ï¼         â”‚       â”‚
â”‚  â€¢ ç‰ˆæœ¬æŽ§åˆ¶ä¸å‹å¥½                             â”‚  # æ— éœ€è½¬æ¢ï¼Œç›´æŽ¥è¿è¡Œ       â”‚       â”‚
â”‚                                               â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â”‚
â”‚                                                                                     â”‚
â”‚                                               ä¼˜åŠ¿:                                 â”‚
â”‚                                               â€¢ ä»£ç å³æ–‡æ¡£                         â”‚
â”‚                                               â€¢ ç›´æŽ¥æ‰§è¡Œï¼Œé›¶è½¬æ¢                   â”‚
â”‚                                               â€¢ IDE æ™ºèƒ½æç¤º                       â”‚
â”‚                                               â€¢ å®Œæ•´è°ƒè¯•èƒ½åŠ›                       â”‚
â”‚                                               â€¢ Git å‹å¥½                           â”‚
â”‚                                                                                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 3.3 åŒå‘ç¼–è¾‘æž¶æž„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                             åŒå‘ç¼–è¾‘æž¶æž„                                             â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚                           å·¥ä½œå°ç•Œé¢                                         â”‚   â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”‚   â”‚
â”‚  â”‚  â”‚                               â”‚                               â”‚          â”‚   â”‚
â”‚  â”‚  â”‚      ä»£ç ç¼–è¾‘å™¨               â”‚       å¯è§†åŒ–ç”»å¸ƒ              â”‚          â”‚   â”‚
â”‚  â”‚  â”‚     (Monaco Editor)           â”‚      (React Flow)             â”‚          â”‚   â”‚
â”‚  â”‚  â”‚                               â”‚                               â”‚          â”‚   â”‚
â”‚  â”‚  â”‚  from langgraph.graph import  â”‚    â”Œâ”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”      â”‚          â”‚   â”‚
â”‚  â”‚  â”‚      StateGraph, END          â”‚    â”‚searchâ”‚â”€â”€â”€â”€â”€â–¶â”‚analyzeâ”‚    â”‚          â”‚   â”‚
â”‚  â”‚  â”‚                               â”‚    â””â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”¬â”€â”€â”˜      â”‚          â”‚   â”‚
â”‚  â”‚  â”‚  graph = StateGraph(State)    â”‚                    â”‚          â”‚          â”‚   â”‚
â”‚  â”‚  â”‚  graph.add_node("search",..)  â”‚                    â–¼          â”‚          â”‚   â”‚
â”‚  â”‚  â”‚  graph.add_node("analyze",..) â”‚               â”Œâ”€â”€â”€â”€â”€â”         â”‚          â”‚   â”‚
â”‚  â”‚  â”‚  graph.add_edge(...)          â”‚               â”‚ END â”‚         â”‚          â”‚   â”‚
â”‚  â”‚  â”‚                               â”‚               â””â”€â”€â”€â”€â”€â”˜         â”‚          â”‚   â”‚
â”‚  â”‚  â”‚                               â”‚                               â”‚          â”‚   â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â”‚   â”‚
â”‚  â”‚                    â–²                               â”‚                         â”‚   â”‚
â”‚  â”‚                    â”‚         å®žæ—¶åŒæ­¥              â”‚                         â”‚   â”‚
â”‚  â”‚                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                         â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                                     â”‚
â”‚  åŒæ­¥æœºåˆ¶:                                                                          â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚
â”‚                                                                                     â”‚
â”‚  ä»£ç  â†’ å¯è§†åŒ–:                                                                     â”‚
â”‚  1. ç›‘å¬ä»£ç æ–‡ä»¶å˜æ›´                                                               â”‚
â”‚  2. è§£æž Python ASTï¼Œæå– StateGraph ç»“æž„                                          â”‚
â”‚  3. è½¬æ¢ä¸º React Flow æ ¼å¼ {nodes: [], edges: []}                                  â”‚
â”‚  4. æ›´æ–°ç”»å¸ƒæ¸²æŸ“                                                                   â”‚
â”‚                                                                                     â”‚
â”‚  å¯è§†åŒ– â†’ ä»£ç :                                                                     â”‚
â”‚  1. ç›‘å¬ UI æ“ä½œ (æ·»åŠ èŠ‚ç‚¹ã€è¿žæŽ¥è¾¹ã€åˆ é™¤ç­‰)                                        â”‚
â”‚  2. ç”Ÿæˆå¯¹åº”çš„ Python ä»£ç ç‰‡æ®µ                                                     â”‚
â”‚  3. ä½¿ç”¨ AST é‡å†™æŠ€æœ¯ï¼Œç²¾å‡†ä¿®æ”¹ä»£ç                                                 â”‚
â”‚  4. ä¿ç•™ç”¨æˆ·çš„ä»£ç æ ¼å¼å’Œæ³¨é‡Š                                                       â”‚
â”‚                                                                                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 3.4 ä»£ç è§£æžå™¨å®žçŽ°

```python
# backend/studio/parser/graph_parser.py

import ast
from typing import Dict, List, Any, Optional
from dataclasses import dataclass

@dataclass
class ParsedNode:
    """è§£æžå‡ºçš„èŠ‚ç‚¹"""
    id: str
    name: str
    func_name: str
    line_number: int
    
@dataclass  
class ParsedEdge:
    """è§£æžå‡ºçš„è¾¹"""
    source: str
    target: str
    condition: Optional[str] = None
    line_number: int = 0

@dataclass
class ParsedGraph:
    """è§£æžå‡ºçš„å›¾ç»“æž„"""
    nodes: List[ParsedNode]
    edges: List[ParsedEdge]
    state_class: Optional[str]
    source_file: str

class LangGraphParser:
    """LangGraph ä»£ç è§£æžå™¨"""
    
    def parse_file(self, file_path: str) -> ParsedGraph:
        """è§£æž Python æ–‡ä»¶ï¼Œæå–å›¾ç»“æž„"""
        with open(file_path, 'r') as f:
            source = f.read()
        return self.parse_source(source, file_path)
    
    def parse_source(self, source: str, file_path: str = "") -> ParsedGraph:
        """è§£æžæºä»£ç """
        tree = ast.parse(source)
        
        nodes = []
        edges = []
        state_class = None
        
        for node in ast.walk(tree):
            # æŸ¥æ‰¾ StateGraph å®žä¾‹åŒ–
            if isinstance(node, ast.Call):
                if self._is_stategraph_call(node):
                    state_class = self._extract_state_class(node)
                    
            # æŸ¥æ‰¾ add_node è°ƒç”¨
            if isinstance(node, ast.Call):
                if self._is_add_node_call(node):
                    parsed_node = self._parse_add_node(node)
                    if parsed_node:
                        nodes.append(parsed_node)
                        
            # æŸ¥æ‰¾ add_edge è°ƒç”¨
            if isinstance(node, ast.Call):
                if self._is_add_edge_call(node):
                    parsed_edge = self._parse_add_edge(node)
                    if parsed_edge:
                        edges.append(parsed_edge)
                        
            # æŸ¥æ‰¾ add_conditional_edges è°ƒç”¨
            if isinstance(node, ast.Call):
                if self._is_conditional_edge_call(node):
                    parsed_edges = self._parse_conditional_edges(node)
                    edges.extend(parsed_edges)
        
        return ParsedGraph(
            nodes=nodes,
            edges=edges,
            state_class=state_class,
            source_file=file_path
        )
    
    def _is_add_node_call(self, node: ast.Call) -> bool:
        """æ£€æŸ¥æ˜¯å¦æ˜¯ graph.add_node() è°ƒç”¨"""
        if isinstance(node.func, ast.Attribute):
            return node.func.attr == "add_node"
        return False
    
    def _parse_add_node(self, node: ast.Call) -> Optional[ParsedNode]:
        """è§£æž add_node è°ƒç”¨"""
        if len(node.args) >= 2:
            node_name = ast.literal_eval(node.args[0])
            func_name = node.args[1].id if isinstance(node.args[1], ast.Name) else str(node.args[1])
            return ParsedNode(
                id=node_name,
                name=node_name,
                func_name=func_name,
                line_number=node.lineno
            )
        return None
    
    # ... æ›´å¤šè§£æžæ–¹æ³•

def to_react_flow_format(parsed: ParsedGraph) -> Dict[str, Any]:
    """è½¬æ¢ä¸º React Flow æ ¼å¼"""
    nodes = []
    edges = []
    
    # è‡ªåŠ¨å¸ƒå±€ä½ç½®è®¡ç®—
    for i, node in enumerate(parsed.nodes):
        nodes.append({
            "id": node.id,
            "type": "custom",  # è‡ªå®šä¹‰èŠ‚ç‚¹ç±»åž‹
            "position": {"x": 100 + (i % 3) * 250, "y": 100 + (i // 3) * 150},
            "data": {
                "label": node.name,
                "func": node.func_name,
                "line": node.line_number
            }
        })
    
    for edge in parsed.edges:
        edges.append({
            "id": f"{edge.source}-{edge.target}",
            "source": edge.source,
            "target": edge.target,
            "label": edge.condition,
            "type": "smoothstep"
        })
    
    return {"nodes": nodes, "edges": edges}
```

### 3.5 ä»£ç ç”Ÿæˆå™¨å®žçŽ°

```python
# backend/studio/codegen/graph_codegen.py

from typing import Dict, List, Any
import ast
import astor  # AST to source code

class LangGraphCodeGen:
    """LangGraph ä»£ç ç”Ÿæˆå™¨"""
    
    def __init__(self, source_file: str):
        self.source_file = source_file
        with open(source_file, 'r') as f:
            self.source = f.read()
        self.tree = ast.parse(self.source)
    
    def add_node(self, node_name: str, func_name: str) -> str:
        """æ·»åŠ èŠ‚ç‚¹ï¼Œè¿”å›žæ›´æ–°åŽçš„ä»£ç """
        # æ‰¾åˆ°æœ€åŽä¸€ä¸ª add_node è°ƒç”¨çš„ä½ç½®
        insert_line = self._find_last_add_node_line()
        
        # ç”Ÿæˆæ–°çš„ä»£ç è¡Œ
        new_line = f'graph.add_node("{node_name}", {func_name})'
        
        # æ’å…¥ä»£ç 
        lines = self.source.split('\n')
        lines.insert(insert_line, new_line)
        
        return '\n'.join(lines)
    
    def add_edge(self, source: str, target: str) -> str:
        """æ·»åŠ è¾¹"""
        insert_line = self._find_last_add_edge_line()
        new_line = f'graph.add_edge("{source}", "{target}")'
        
        lines = self.source.split('\n')
        lines.insert(insert_line, new_line)
        
        return '\n'.join(lines)
    
    def remove_node(self, node_name: str) -> str:
        """åˆ é™¤èŠ‚ç‚¹"""
        # ä½¿ç”¨ AST é‡å†™ï¼Œåˆ é™¤å¯¹åº”çš„ add_node è°ƒç”¨
        class NodeRemover(ast.NodeTransformer):
            def visit_Expr(self, node):
                if isinstance(node.value, ast.Call):
                    if self._is_add_node_for(node.value, node_name):
                        return None  # åˆ é™¤æ­¤èŠ‚ç‚¹
                return node
        
        new_tree = NodeRemover().visit(self.tree)
        return astor.to_source(new_tree)
    
    def update_from_react_flow(self, flow_data: Dict[str, Any]) -> str:
        """ä»Ž React Flow æ•°æ®æ›´æ–°ä»£ç """
        # æ¯”è¾ƒçŽ°æœ‰å›¾ç»“æž„å’Œæ–°çš„ flow_data
        # ç”Ÿæˆå¢žé‡æ›´æ–°ä»£ç 
        pass
```

### 3.6 ä¼ ç»Ÿé…ç½®è½¬æ¢ (å…¼å®¹æ¨¡å¼)

> æ³¨: ä»¥ä¸‹ä¸ºå…¼å®¹æ—§ç‰ˆ JSON é…ç½®çš„è½¬æ¢é€»è¾‘ï¼Œæ–°é¡¹ç›®æŽ¨èä½¿ç”¨ Code-First

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         é…ç½®è½¬æ¢ (å…¼å®¹æ¨¡å¼)                                          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                                     â”‚
â”‚  å¦‚æžœç”¨æˆ·å¯¼å…¥æ—§ç‰ˆ JSON é…ç½®ï¼Œè½¬æ¢ä¸º Python ä»£ç :                                    â”‚
â”‚                                                                                     â”‚
â”‚  JSON è¾“å…¥:                              ç”Ÿæˆçš„ Python ä»£ç :                        â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€            â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€               â”‚
â”‚  {                                       from langgraph.graph import                â”‚
â”‚    "nodes": [                                StateGraph, START, END                 â”‚
â”‚      {"id": "n1", "type": "llm"},                                                   â”‚
â”‚      {"id": "n2", "type": "tool"}        class State(TypedDict):                   â”‚
â”‚    ],                                        messages: list                         â”‚
â”‚    "edges": [                                                                       â”‚
â”‚      {"from": "n1", "to": "n2"}          graph = StateGraph(State)                 â”‚
â”‚    ]                                     graph.add_node("n1", llm_node)            â”‚
â”‚  }                                       graph.add_node("n2", tool_node)           â”‚
â”‚                                          graph.add_edge(START, "n1")               â”‚
â”‚                                          graph.add_edge("n1", "n2")                â”‚
â”‚                                          graph.add_edge("n2", END)                 â”‚
â”‚                                                                                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 3.2 èŠ‚ç‚¹ç±»åž‹æ˜ å°„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                              èŠ‚ç‚¹ç±»åž‹ â†’ Agent Core æ˜ å°„                              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                                     â”‚
â”‚  å·¥ä½œå°èŠ‚ç‚¹                        æ˜ å°„åˆ° Agent Core                                â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚
â”‚                                                                                     â”‚
â”‚  ðŸ“¥ ç”¨æˆ·è¾“å…¥èŠ‚ç‚¹                                                                    â”‚
â”‚  â”œâ”€ UserInput         â†’   Main Loop çš„å…¥å£ç‚¹                                       â”‚
â”‚  â”œâ”€ Webhook           â†’   HTTP Trigger + Main Loop                                 â”‚
â”‚  â””â”€ Schedule          â†’   å®šæ—¶ä»»åŠ¡ + Main Loop                                     â”‚
â”‚                                                                                     â”‚
â”‚  ðŸ§  AgentèŠ‚ç‚¹                                                                       â”‚
â”‚  â”œâ”€ LLMNode           â†’   LLMGateway.chat()                                        â”‚
â”‚  â”‚   â€¢ model           â†’   model é…ç½®                                              â”‚
â”‚  â”‚   â€¢ prompt          â†’   ç»„è£…åˆ°ä¸Šä¸‹æ–‡                                            â”‚
â”‚  â”‚   â€¢ temperature     â†’   generation é…ç½®                                         â”‚
â”‚  â”‚                                                                                 â”‚
â”‚  â”œâ”€ IntentNode        â†’   LLMGateway.chat() + æ„å›¾è§£æž                             â”‚
â”‚  â”‚   â€¢ intents         â†’   è½¬æ¢ä¸ºåˆ†ç±» prompt                                       â”‚
â”‚  â”‚   â€¢ routes          â†’   ç”Ÿæˆåˆ†æ”¯é€»è¾‘                                            â”‚
â”‚  â”‚                                                                                 â”‚
â”‚  â”œâ”€ RAGNode           â†’   MemoryRetriever.retrieve()                               â”‚
â”‚  â”‚   â€¢ knowledge_base  â†’   å‘é‡åº“ collection                                       â”‚
â”‚  â”‚   â€¢ top_k           â†’   æ£€ç´¢æ•°é‡                                                â”‚
â”‚  â”‚                                                                                 â”‚
â”‚  â””â”€ AgentCallNode     â†’   A2A è°ƒç”¨                                                 â”‚
â”‚      â€¢ agent_id        â†’   ç›®æ ‡ Agent                                              â”‚
â”‚      â€¢ input_mapping   â†’   å‚æ•°æ˜ å°„                                                â”‚
â”‚                                                                                     â”‚
â”‚  ðŸ”§ å·¥å…·èŠ‚ç‚¹                                                                        â”‚
â”‚  â”œâ”€ HTTPNode          â†’   ToolExecutor.execute("http_request", ...)                â”‚
â”‚  â”œâ”€ DatabaseNode      â†’   ToolExecutor.execute("query_db", ...)                    â”‚
â”‚  â”œâ”€ CodeNode          â†’   ToolExecutor.execute("run_code", ...)                    â”‚
â”‚  â”œâ”€ FileNode          â†’   ToolExecutor.execute("file_op", ...)                     â”‚
â”‚  â””â”€ MCPNode           â†’   ToolExecutor.execute_mcp(...)                            â”‚
â”‚                                                                                     â”‚
â”‚  âš¡ é€»è¾‘èŠ‚ç‚¹                                                                        â”‚
â”‚  â”œâ”€ ConditionNode     â†’   ExecutionPlan.branches                                   â”‚
â”‚  â”œâ”€ LoopNode          â†’   ExecutionPlan.loops                                      â”‚
â”‚  â”œâ”€ ParallelNode      â†’   asyncio.gather() å¹¶è¡Œæ‰§è¡Œ                                â”‚
â”‚  â””â”€ WaitNode          â†’   Human-in-the-loop ç­‰å¾…                                   â”‚
â”‚                                                                                     â”‚
â”‚  ðŸ“¤ è¾“å‡ºèŠ‚ç‚¹                                                                        â”‚
â”‚  â”œâ”€ ResponseNode      â†’   æµå¼è¿”å›žç»™ç”¨æˆ·                                           â”‚
â”‚  â”œâ”€ NotifyNode        â†’   ToolExecutor.execute("send_notification", ...)           â”‚
â”‚  â””â”€ StoreNode         â†’   MemoryManager.store() / DBå†™å…¥                           â”‚
â”‚                                                                                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 3.3 è½¬æ¢å™¨å®žçŽ°

```python
# backend/studio/orchestrator/converter.py

from typing import Dict, List, Any
from pydantic import BaseModel

class WorkflowDefinition(BaseModel):
    """å·¥ä½œå°å·¥ä½œæµå®šä¹‰"""
    nodes: List[Dict[str, Any]]
    edges: List[Dict[str, str]]
    variables: Dict[str, Any] = {}

class AgentConfig(BaseModel):
    """Agent Core æ‰§è¡Œé…ç½®"""
    agent_id: str
    name: str
    system_prompt: str
    model: str
    tools: List[str]
    memory_config: Dict[str, Any]
    max_iterations: int = 10

class ExecutionPlan(BaseModel):
    """æ‰§è¡Œè®¡åˆ’"""
    steps: List[Dict[str, Any]]
    branches: List[Dict[str, Any]] = []
    loops: List[Dict[str, Any]] = []

class WorkflowConverter:
    """å·¥ä½œæµé…ç½®è½¬æ¢å™¨"""
    
    def __init__(self, tool_registry, agent_registry):
        self.tools = tool_registry
        self.agents = agent_registry
    
    def convert(self, workflow: WorkflowDefinition) -> tuple[AgentConfig, ExecutionPlan]:
        """
        å°†å·¥ä½œå°é…ç½®è½¬æ¢ä¸º Agent Core å¯æ‰§è¡Œé…ç½®
        
        è½¬æ¢æ­¥éª¤:
        1. è§£æžèŠ‚ç‚¹ï¼Œæå–é…ç½®
        2. æž„å»ºæ‰§è¡Œå›¾
        3. ç”Ÿæˆ AgentConfig
        4. ç”Ÿæˆ ExecutionPlan
        """
        # 1. æž„å»ºèŠ‚ç‚¹ç´¢å¼•
        node_map = {node["id"]: node for node in workflow.nodes}
        
        # 2. æž„å»ºé‚»æŽ¥è¡¨
        adjacency = self._build_adjacency(workflow.edges)
        
        # 3. æå– System Prompt (ä»Ž LLM èŠ‚ç‚¹)
        system_prompt = self._extract_system_prompt(node_map)
        
        # 4. æ”¶é›†å·¥å…·åˆ—è¡¨
        tools = self._collect_tools(node_map)
        
        # 5. æå–æ¨¡åž‹é…ç½®
        model_config = self._extract_model_config(node_map)
        
        # 6. ç”Ÿæˆæ‰§è¡Œè®¡åˆ’
        execution_plan = self._generate_execution_plan(
            node_map, adjacency, workflow.variables
        )
        
        # æž„å»º AgentConfig
        agent_config = AgentConfig(
            agent_id=workflow.id,
            name=workflow.name,
            system_prompt=system_prompt,
            model=model_config.get("model", "claude-3-5-sonnet-20241022"),
            tools=tools,
            memory_config=self._extract_memory_config(node_map),
        )
        
        return agent_config, execution_plan
    
    def _extract_system_prompt(self, node_map: Dict) -> str:
        """ä»Ž LLM èŠ‚ç‚¹æå– System Prompt"""
        prompts = []
        
        for node in node_map.values():
            if node["type"] == "llm" and node.get("config", {}).get("system_prompt"):
                prompts.append(node["config"]["system_prompt"])
        
        return "\n\n".join(prompts) if prompts else ""
    
    def _collect_tools(self, node_map: Dict) -> List[str]:
        """æ”¶é›†æ‰€æœ‰ä½¿ç”¨çš„å·¥å…·"""
        tools = set()
        
        for node in node_map.values():
            node_type = node["type"]
            
            # å·¥å…·èŠ‚ç‚¹ç›´æŽ¥æ·»åŠ 
            if node_type == "http":
                tools.add("http_request")
            elif node_type == "database":
                tools.add("query_db")
            elif node_type == "code":
                tools.add("run_code")
            elif node_type == "file":
                tools.add("file_op")
            elif node_type == "mcp":
                tools.add(f"mcp:{node['config']['tool_name']}")
        
        return list(tools)
    
    def _generate_execution_plan(
        self,
        node_map: Dict,
        adjacency: Dict,
        variables: Dict,
    ) -> ExecutionPlan:
        """ç”Ÿæˆæ‰§è¡Œè®¡åˆ’"""
        steps = []
        branches = []
        loops = []
        
        # æ‹“æ‰‘æŽ’åºèŽ·å–æ‰§è¡Œé¡ºåº
        sorted_nodes = self._topological_sort(node_map, adjacency)
        
        for node_id in sorted_nodes:
            node = node_map[node_id]
            
            if node["type"] == "condition":
                # æ¡ä»¶åˆ†æ”¯
                branches.append({
                    "node_id": node_id,
                    "conditions": node["config"]["conditions"],
                    "routes": self._get_branch_routes(node_id, adjacency),
                })
            elif node["type"] == "loop":
                # å¾ªçŽ¯
                loops.append({
                    "node_id": node_id,
                    "condition": node["config"]["condition"],
                    "body_nodes": node["config"]["body_nodes"],
                })
            else:
                # æ™®é€šæ­¥éª¤
                steps.append({
                    "node_id": node_id,
                    "type": node["type"],
                    "config": node["config"],
                })
        
        return ExecutionPlan(
            steps=steps,
            branches=branches,
            loops=loops,
        )
```

---

## å››ã€æ‰§è¡Œè°ƒç”¨é›†æˆ

### 4.1 è°ƒç”¨é“¾è·¯

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                               æ‰§è¡Œè°ƒç”¨é“¾è·¯                                           â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                                     â”‚
â”‚  å·¥ä½œå°                          Studio Service                   Agent Core        â”‚
â”‚                                                                                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                                                        â”‚
â”‚  â”‚ è°ƒè¯•æµ‹è¯• â”‚                                                                        â”‚
â”‚  â”‚  ç•Œé¢   â”‚                                                                        â”‚
â”‚  â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜                                                                        â”‚
â”‚       â”‚ 1. å‘èµ·æµ‹è¯•è¿è¡Œ                                                             â”‚
â”‚       â–¼                                                                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                       â”‚
â”‚  â”‚     POST /api/v1/studio/test/run        â”‚                                       â”‚
â”‚  â”‚     {                                   â”‚                                       â”‚
â”‚  â”‚       "workflow_id": "...",             â”‚                                       â”‚
â”‚  â”‚       "input": {"message": "..."},      â”‚                                       â”‚
â”‚  â”‚       "variables": {...}                â”‚                                       â”‚
â”‚  â”‚     }                                   â”‚                                       â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                       â”‚
â”‚                   â”‚                                                                 â”‚
â”‚                   â”‚ 2. èŽ·å–å·¥ä½œæµé…ç½®                                               â”‚
â”‚                   â–¼                                                                 â”‚
â”‚            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                                        â”‚
â”‚            â”‚ TestRunner   â”‚                                                        â”‚
â”‚            â”‚  Service     â”‚                                                        â”‚
â”‚            â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜                                                        â”‚
â”‚                   â”‚                                                                 â”‚
â”‚                   â”‚ 3. è½¬æ¢é…ç½®                                                     â”‚
â”‚                   â–¼                                                                 â”‚
â”‚            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                                        â”‚
â”‚            â”‚  Converter   â”‚                                                        â”‚
â”‚            â”‚  (é…ç½®è½¬æ¢)  â”‚                                                        â”‚
â”‚            â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜                                                        â”‚
â”‚                   â”‚                                                                 â”‚
â”‚                   â”‚ 4. AgentConfig + ExecutionPlan                                 â”‚
â”‚                   â–¼                                                                 â”‚
â”‚            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”‚
â”‚            â”‚                      AgentEngine                              â”‚        â”‚
â”‚            â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚        â”‚
â”‚            â”‚  â”‚                    Main Loop                            â”‚  â”‚        â”‚
â”‚            â”‚  â”‚   5. ç»„è£…ä¸Šä¸‹æ–‡ â”€â–¶ ContextManager.build()              â”‚  â”‚        â”‚
â”‚            â”‚  â”‚   6. è°ƒç”¨æ¨¡åž‹   â”€â–¶ LLMGateway.chat()                   â”‚  â”‚        â”‚
â”‚            â”‚  â”‚   7. æ‰§è¡Œå·¥å…·   â”€â–¶ ToolExecutor.execute()              â”‚  â”‚        â”‚
â”‚            â”‚  â”‚   8. æ›´æ–°è®°å¿†   â”€â–¶ MemoryManager.process()             â”‚  â”‚        â”‚
â”‚            â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚        â”‚
â”‚            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â”‚
â”‚                   â”‚                                                                 â”‚
â”‚                   â”‚ 9. æµå¼è¿”å›žæ‰§è¡Œäº‹ä»¶ (SSE)                                       â”‚
â”‚                   â–¼                                                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                       â”‚
â”‚  â”‚     SSE Stream                          â”‚                                       â”‚
â”‚  â”‚     event: trace                        â”‚                                       â”‚
â”‚  â”‚     data: {                             â”‚                                       â”‚
â”‚  â”‚       "type": "llm_call",               â”‚                                       â”‚
â”‚  â”‚       "duration_ms": 1234,              â”‚                                       â”‚
â”‚  â”‚       "tokens": {...}                   â”‚                                       â”‚
â”‚  â”‚     }                                   â”‚                                       â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                       â”‚
â”‚                   â”‚                                                                 â”‚
â”‚                   â”‚ 10. å®žæ—¶å±•ç¤º                                                    â”‚
â”‚                   â–¼                                                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                                                        â”‚
â”‚  â”‚ æ‰§è¡Œè¿½è¸ª â”‚                                                                        â”‚
â”‚  â”‚  å±•ç¤º   â”‚                                                                        â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                                                        â”‚
â”‚                                                                                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 4.2 TestRunner å®žçŽ°

```python
# backend/studio/test_runner/runner.py

from typing import AsyncGenerator
from pydantic import BaseModel

class TestRunRequest(BaseModel):
    workflow_id: str
    input: dict
    variables: dict = {}

class TraceEvent(BaseModel):
    """æ‰§è¡Œè¿½è¸ªäº‹ä»¶"""
    type: str  # context_build, llm_call, tool_call, memory_update, done, error
    node_id: str | None = None
    timestamp: float
    duration_ms: int | None = None
    data: dict = {}

class TestRunner:
    """æµ‹è¯•è¿è¡Œå™¨ - è¿žæŽ¥å·¥ä½œå°ä¸Ž Agent Core"""
    
    def __init__(
        self,
        workflow_repo: WorkflowRepository,
        converter: WorkflowConverter,
        agent_engine_factory: AgentEngineFactory,
    ):
        self.workflows = workflow_repo
        self.converter = converter
        self.engine_factory = agent_engine_factory
    
    async def run(
        self,
        request: TestRunRequest,
    ) -> AsyncGenerator[TraceEvent, None]:
        """
        æ‰§è¡Œæµ‹è¯•è¿è¡Œ
        
        1. èŽ·å–å·¥ä½œæµé…ç½®
        2. è½¬æ¢ä¸ºæ‰§è¡Œé…ç½®
        3. åˆ›å»ºä¸´æ—¶ AgentEngine
        4. æ‰§è¡Œå¹¶æµå¼è¿”å›žè¿½è¸ªäº‹ä»¶
        """
        # 1. èŽ·å–å·¥ä½œæµ
        workflow = await self.workflows.get(request.workflow_id)
        if not workflow:
            yield TraceEvent(
                type="error",
                timestamp=time.time(),
                data={"error": "Workflow not found"}
            )
            return
        
        # 2. è½¬æ¢é…ç½®
        try:
            agent_config, execution_plan = self.converter.convert(
                workflow.definition
            )
        except Exception as e:
            yield TraceEvent(
                type="error",
                timestamp=time.time(),
                data={"error": f"Config conversion failed: {e}"}
            )
            return
        
        # 3. åˆ›å»ºä¸´æ—¶ Agent Engine (å¸¦è¿½è¸ª)
        engine = self.engine_factory.create(
            config=agent_config,
            execution_plan=execution_plan,
            enable_tracing=True,  # å¯ç”¨è¿½è¸ª
        )
        
        # 4. æ‰§è¡Œå¹¶è½¬å‘è¿½è¸ªäº‹ä»¶
        try:
            async for event in engine.run_with_trace(
                user_input=request.input.get("message", ""),
                session_id=f"test_{request.workflow_id}_{time.time()}",
                variables=request.variables,
            ):
                yield self._convert_engine_event(event)
        except Exception as e:
            yield TraceEvent(
                type="error",
                timestamp=time.time(),
                data={"error": str(e)}
            )
    
    def _convert_engine_event(self, engine_event) -> TraceEvent:
        """å°† Agent Engine äº‹ä»¶è½¬æ¢ä¸ºè¿½è¸ªäº‹ä»¶"""
        return TraceEvent(
            type=engine_event.type,
            node_id=engine_event.node_id,
            timestamp=engine_event.timestamp,
            duration_ms=engine_event.duration_ms,
            data={
                "content": engine_event.content,
                "tokens": engine_event.tokens,
                "tool_call": engine_event.tool_call,
                "tool_result": engine_event.tool_result,
            }
        )
```

### 4.3 Agent Engine æ‰©å±• (æ”¯æŒè¿½è¸ª)

```python
# backend/core/agent/engine.py (æ‰©å±•)

class AgentEngine:
    """Agent æ‰§è¡Œå¼•æ“Ž (æ‰©å±•è¿½è¸ªèƒ½åŠ›)"""
    
    async def run_with_trace(
        self,
        user_input: str,
        session_id: str,
        variables: dict = {},
    ) -> AsyncGenerator[EngineEvent, None]:
        """
        å¸¦è¿½è¸ªçš„æ‰§è¡Œæ¨¡å¼ - ä¾›å·¥ä½œå°è°ƒè¯•ä½¿ç”¨
        """
        iteration = 0
        start_time = time.time()
        
        while iteration < self.config.max_iterations:
            iteration += 1
            
            # è¿½è¸ª: ä¸Šä¸‹æ–‡ç»„è£…
            ctx_start = time.time()
            context = await self.context.build(
                session_id=session_id,
                user_input=user_input,
                system_prompt=self.config.system_prompt,
            )
            yield EngineEvent(
                type="context_build",
                timestamp=ctx_start,
                duration_ms=int((time.time() - ctx_start) * 1000),
                data={
                    "total_tokens": context.total_tokens,
                    "breakdown": {
                        "system": self.counter.count(self.config.system_prompt),
                        "history": context.history_tokens,
                        "memory": context.memory_tokens,
                    }
                }
            )
            
            # è¿½è¸ª: LLM è°ƒç”¨
            llm_start = time.time()
            response = await self.llm.chat(
                messages=context.messages,
                tools=self.tools.get_definitions(),
                model=self.config.model,
                stream=True,
            )
            
            full_response = ""
            tool_calls = []
            input_tokens = 0
            output_tokens = 0
            
            async for chunk in response:
                if chunk.type == "text":
                    full_response += chunk.content
                    yield EngineEvent(
                        type="text_chunk",
                        timestamp=time.time(),
                        data={"content": chunk.content}
                    )
                elif chunk.type == "tool_call":
                    tool_calls.append(chunk.tool_call)
                elif chunk.type == "usage":
                    input_tokens = chunk.input_tokens
                    output_tokens = chunk.output_tokens
            
            yield EngineEvent(
                type="llm_call",
                timestamp=llm_start,
                duration_ms=int((time.time() - llm_start) * 1000),
                data={
                    "model": self.config.model,
                    "input_tokens": input_tokens,
                    "output_tokens": output_tokens,
                    "has_tool_calls": len(tool_calls) > 0,
                }
            )
            
            # è¿½è¸ª: å·¥å…·è°ƒç”¨
            if tool_calls:
                for tool_call in tool_calls:
                    tool_start = time.time()
                    
                    yield EngineEvent(
                        type="tool_call_start",
                        timestamp=tool_start,
                        data={
                            "tool": tool_call.name,
                            "args": tool_call.arguments,
                        }
                    )
                    
                    result = await self.tools.execute(
                        name=tool_call.name,
                        arguments=tool_call.arguments,
                        session_id=session_id,
                    )
                    
                    yield EngineEvent(
                        type="tool_call_end",
                        timestamp=tool_start,
                        duration_ms=int((time.time() - tool_start) * 1000),
                        data={
                            "tool": tool_call.name,
                            "success": result.success,
                            "output": result.output[:500],  # æˆªæ–­
                            "error": result.error,
                        }
                    )
                    
                    await self.context.add_tool_result(
                        session_id=session_id,
                        tool_call=tool_call,
                        result=result,
                    )
                
                user_input = None
                continue
            
            # è¿½è¸ª: è®°å¿†æ›´æ–°
            if full_response:
                memory_start = time.time()
                await self.memory.process(
                    session_id=session_id,
                    content=full_response,
                )
                yield EngineEvent(
                    type="memory_update",
                    timestamp=memory_start,
                    duration_ms=int((time.time() - memory_start) * 1000),
                )
            
            # å®Œæˆ
            yield EngineEvent(
                type="done",
                timestamp=start_time,
                duration_ms=int((time.time() - start_time) * 1000),
                data={
                    "iterations": iteration,
                    "response": full_response,
                }
            )
            break
```

### 4.3 è¿è¡Œæ—¶çŠ¶æ€å¯è§†åŒ–é›†æˆ

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                           è¿è¡Œæ—¶çŠ¶æ€å¯è§†åŒ–é›†æˆæž¶æž„                                   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚                         å·¥ä½œå°å‰ç«¯ (React)                                   â”‚   â”‚
â”‚  â”‚                                                                              â”‚   â”‚
â”‚  â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”‚   â”‚
â”‚  â”‚   â”‚  æ‰§è¡Œæµç¨‹       â”‚  â”‚   å½“å‰çŠ¶æ€          â”‚  â”‚   æ‰§è¡Œæ—¥å¿—           â”‚      â”‚   â”‚
â”‚  â”‚   â”‚  (èŠ‚ç‚¹é«˜äº®)     â”‚  â”‚   (å®žæ—¶æ›´æ–°)        â”‚  â”‚   (WebSocketæµ)      â”‚      â”‚   â”‚
â”‚  â”‚   â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤      â”‚   â”‚
â”‚  â”‚   â”‚ [å…¥å£] âœ“       â”‚  â”‚ messages: 3        â”‚  â”‚ â–¶ è¿›å…¥èŠ‚ç‚¹: think    â”‚      â”‚   â”‚
â”‚  â”‚   â”‚   â†“            â”‚  â”‚ context: {...}     â”‚  â”‚ âš¡ è°ƒç”¨: search      â”‚      â”‚   â”‚
â”‚  â”‚   â”‚ [æ€è€ƒ] ðŸ”µ      â”‚  â”‚ iteration: 2       â”‚  â”‚ ðŸ’¬ LLM: æ ¹æ®æœç´¢...  â”‚      â”‚   â”‚
â”‚  â”‚   â”‚   â†“            â”‚  â”‚                    â”‚  â”‚ âœ“ å®Œæˆ: think 2.3s  â”‚      â”‚   â”‚
â”‚  â”‚   â”‚ [æ‰§è¡Œ] â—‹       â”‚  â”‚                    â”‚  â”‚                      â”‚      â”‚   â”‚
â”‚  â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â”‚   â”‚
â”‚  â”‚                                                                              â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                         â”‚ WebSocket                                 â”‚
â”‚                                         â–¼                                           â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚                      æ‰§è¡Œè¿½è¸ªæœåŠ¡ (ExecutionTracer)                          â”‚   â”‚
â”‚  â”‚                                                                              â”‚   â”‚
â”‚  â”‚   äº‹ä»¶ç±»åž‹:                                                                  â”‚   â”‚
â”‚  â”‚   â”œâ”€ NODE_ENTER / NODE_EXIT     èŠ‚ç‚¹è¿›å…¥/é€€å‡º â†’ æµç¨‹å›¾é«˜äº®                  â”‚   â”‚
â”‚  â”‚   â”œâ”€ STATE_UPDATE               çŠ¶æ€å˜åŒ– â†’ çŠ¶æ€é¢æ¿æ›´æ–°                     â”‚   â”‚
â”‚  â”‚   â”œâ”€ LLM_REQUEST / LLM_STREAM   LLMè°ƒç”¨ â†’ æ€è€ƒè¿‡ç¨‹å±•ç¤º                      â”‚   â”‚
â”‚  â”‚   â”œâ”€ TOOL_CALL / TOOL_RESULT    å·¥å…·è°ƒç”¨ â†’ è°ƒç”¨è¯¦æƒ…å±•ç¤º                     â”‚   â”‚
â”‚  â”‚   â”œâ”€ CHECKPOINT_SAVE            æ£€æŸ¥ç‚¹ â†’ å¯å›žæº¯çŠ¶æ€                         â”‚   â”‚
â”‚  â”‚   â””â”€ ERROR                      é”™è¯¯ â†’ é”™è¯¯å®šä½å’Œå±•ç¤º                       â”‚   â”‚
â”‚  â”‚                                                                              â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                         â”‚ emit()                                    â”‚
â”‚                                         â–¼                                           â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚                          AgentEngine (Agent Core)                            â”‚   â”‚
â”‚  â”‚                                                                              â”‚   â”‚
â”‚  â”‚   Main Loop ä¸­é›†æˆè¿½è¸ª:                                                      â”‚   â”‚
â”‚  â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚   â”‚
â”‚  â”‚   â”‚  async for state in graph.astream(input):                             â”‚  â”‚   â”‚
â”‚  â”‚   â”‚      # è¿›å…¥èŠ‚ç‚¹                                                       â”‚  â”‚   â”‚
â”‚  â”‚   â”‚      await tracer.node_enter(node_id, node_name, state)               â”‚  â”‚   â”‚
â”‚  â”‚   â”‚                                                                       â”‚  â”‚   â”‚
â”‚  â”‚   â”‚      # æ‰§è¡ŒèŠ‚ç‚¹é€»è¾‘...                                                â”‚  â”‚   â”‚
â”‚  â”‚   â”‚      result = await node_func(state)                                  â”‚  â”‚   â”‚
â”‚  â”‚   â”‚                                                                       â”‚  â”‚   â”‚
â”‚  â”‚   â”‚      # é€€å‡ºèŠ‚ç‚¹                                                       â”‚  â”‚   â”‚
â”‚  â”‚   â”‚      await tracer.node_exit(node_id, node_name, result)               â”‚  â”‚   â”‚
â”‚  â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚   â”‚
â”‚  â”‚                                                                              â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### WebSocket ç«¯ç‚¹

```python
# backend/api/routes/execution.py

from fastapi import APIRouter, WebSocket, WebSocketDisconnect
from backend.services.execution_tracer import ExecutionTracer

router = APIRouter()

@router.websocket("/ws/execution/{session_id}")
async def execution_websocket(websocket: WebSocket, session_id: str):
    """æ‰§è¡ŒçŠ¶æ€ WebSocket - å®žæ—¶æŽ¨é€æ‰§è¡Œäº‹ä»¶åˆ°å‰ç«¯"""
    await websocket.accept()
    
    tracer = get_or_create_tracer(session_id)
    queue = tracer.subscribe()
    
    try:
        while True:
            event = await queue.get()
            await websocket.send_json({
                "id": event.id,
                "type": event.type.value,
                "timestamp": event.timestamp.isoformat(),
                "node_id": event.node_id,
                "node_name": event.node_name,
                "data": event.data,
                "duration_ms": event.duration_ms,
                "state_snapshot": event.state_snapshot  # ç”¨äºŽ Time Travel
            })
    except WebSocketDisconnect:
        tracer.unsubscribe(queue)
```

#### å‰ç«¯é›†æˆ

```typescript
// frontend/src/hooks/useExecutionTracer.ts

import { useEffect, useState } from 'react';
import { useWebSocket } from './useWebSocket';

interface TraceEvent {
  id: string;
  type: 'node_enter' | 'node_exit' | 'state_update' | 'llm_stream_chunk' | 
        'tool_call' | 'tool_result' | 'error';
  timestamp: string;
  node_id?: string;
  node_name?: string;
  data: Record<string, any>;
  duration_ms?: number;
  state_snapshot?: Record<string, any>;
}

export function useExecutionTracer(sessionId: string) {
  const [events, setEvents] = useState<TraceEvent[]>([]);
  const [currentNode, setCurrentNode] = useState<string | null>(null);
  const [currentState, setCurrentState] = useState<Record<string, any>>({});
  
  const { lastMessage } = useWebSocket(`/ws/execution/${sessionId}`);
  
  useEffect(() => {
    if (lastMessage) {
      const event = JSON.parse(lastMessage.data) as TraceEvent;
      setEvents(prev => [...prev, event]);
      
      // æ›´æ–°å½“å‰èŠ‚ç‚¹é«˜äº®
      if (event.type === 'node_enter') {
        setCurrentNode(event.node_id || null);
      } else if (event.type === 'node_exit') {
        setCurrentNode(null);
      }
      
      // æ›´æ–°çŠ¶æ€å¿«ç…§
      if (event.state_snapshot) {
        setCurrentState(event.state_snapshot);
      }
    }
  }, [lastMessage]);
  
  // Time Travel: æŸ¥çœ‹åŽ†å²çŠ¶æ€
  const getStateAt = (eventId: string) => {
    const event = events.find(e => e.id === eventId);
    return event?.state_snapshot || null;
  };
  
  return { events, currentNode, currentState, getStateAt };
}
```

---

## äº”ã€æ•°æ®æ¨¡åž‹å…±äº«

### 5.1 å…±äº«æ•°æ®è¡¨

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                               æ•°æ®æ¨¡åž‹å…±äº«è®¾è®¡                                       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚                          Agent Core æ•°æ®æ¨¡åž‹                                 â”‚   â”‚
â”‚  â”‚                                                                              â”‚   â”‚
â”‚  â”‚   users â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶ agents â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶ sessions â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶ messages          â”‚   â”‚
â”‚  â”‚                      â”‚                    â”‚                                  â”‚   â”‚
â”‚  â”‚                      â”‚                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶ tool_calls            â”‚   â”‚
â”‚  â”‚                      â”‚                                                       â”‚   â”‚
â”‚  â”‚                      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶ memories                                    â”‚   â”‚
â”‚  â”‚                                                                              â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                       â”‚                                             â”‚
â”‚                                       â”‚ æ‰©å±•                                        â”‚
â”‚                                       â–¼                                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚                          å·¥ä½œå°æ‰©å±•æ•°æ®æ¨¡åž‹                                   â”‚   â”‚
â”‚  â”‚                                                                              â”‚   â”‚
â”‚  â”‚   agents â—€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ workflows â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶ workflow_versions                 â”‚   â”‚
â”‚  â”‚      â”‚                    â”‚                                                  â”‚   â”‚
â”‚  â”‚      â”‚                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶ deployments                            â”‚   â”‚
â”‚  â”‚      â”‚                                                                       â”‚   â”‚
â”‚  â”‚      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶ prompt_versions                                             â”‚   â”‚
â”‚  â”‚                                                                              â”‚   â”‚
â”‚  â”‚   templates (ç‹¬ç«‹)                                                           â”‚   â”‚
â”‚  â”‚                                                                              â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                                     â”‚
â”‚  å…³ç³»è¯´æ˜Ž:                                                                          â”‚
â”‚  â€¢ agents è¡¨è¢«ä¸¤è¾¹å…±ç”¨ï¼Œå·¥ä½œå°åˆ›å»ºï¼ŒAgent Core æ‰§è¡Œ                                 â”‚
â”‚  â€¢ workflows å±žäºŽ agentsï¼Œå®šä¹‰å¯è§†åŒ–ç¼–æŽ’                                            â”‚
â”‚  â€¢ workflow_versions è®°å½•ç¼–æŽ’åŽ†å²                                                   â”‚
â”‚  â€¢ deployments è®°å½•éƒ¨ç½²çŠ¶æ€ï¼Œå…³è”åˆ°ç‰¹å®šç‰ˆæœ¬                                         â”‚
â”‚  â€¢ prompt_versions è®°å½•æç¤ºè¯åŽ†å²                                                   â”‚
â”‚                                                                                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 5.2 æ•°æ®åŒæ­¥æœºåˆ¶

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                               æ•°æ®åŒæ­¥æœºåˆ¶                                           â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                                     â”‚
â”‚  åœºæ™¯ 1: å·¥ä½œå°åˆ›å»º/ç¼–è¾‘ Agent                                                      â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚
â”‚                                                                                     â”‚
â”‚  å·¥ä½œå°                                              Agent Core                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”               â”‚
â”‚  â”‚ ä¿å­˜å·¥ä½œæµ   â”‚ â”€â”€â”€â–¶ workflows è¡¨                 â”‚              â”‚               â”‚
â”‚  â”‚              â”‚ â”€â”€â”€â–¶ ç¼–è¯‘é…ç½® â”€â”€â”€â–¶ agents è¡¨     â”‚ è¯»å–æ‰§è¡Œé…ç½® â”‚               â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                   (compiled_config)â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜               â”‚
â”‚                                                                                     â”‚
â”‚  åœºæ™¯ 2: Agent Core æ‰§è¡Œäº§ç”Ÿæ•°æ®                                                    â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚
â”‚                                                                                     â”‚
â”‚  Agent Core                                         å·¥ä½œå°                          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”               â”‚
â”‚  â”‚ æ‰§è¡Œå¯¹è¯     â”‚ â”€â”€â”€â–¶ sessions/messages è¡¨        â”‚ æŸ¥çœ‹æ‰§è¡ŒåŽ†å² â”‚               â”‚
â”‚  â”‚ å­˜å‚¨è®°å¿†     â”‚ â”€â”€â”€â–¶ memories è¡¨ + å‘é‡åº“        â”‚ æŸ¥çœ‹è®°å¿†å†…å®¹ â”‚               â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜               â”‚
â”‚                                                                                     â”‚
â”‚  åœºæ™¯ 3: éƒ¨ç½²åŒæ­¥                                                                   â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚
â”‚                                                                                     â”‚
â”‚  å·¥ä½œå°                               éƒ¨ç½²æœåŠ¡                   Agent Core         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”           â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ å‘èµ·éƒ¨ç½²     â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶â”‚ åˆ›å»ºéƒ¨ç½²è®°å½• â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶â”‚ åŠ è½½é…ç½®     â”‚   â”‚
â”‚  â”‚ workflow_v1  â”‚                    â”‚ deployments  â”‚           â”‚ å¯åŠ¨å®žä¾‹     â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜           â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## å…­ã€API è¾¹ç•Œè®¾è®¡

### 6.1 API èŒè´£åˆ’åˆ†

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                               API è¾¹ç•Œè®¾è®¡                                           â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                                     â”‚
â”‚  /api/v1                                                                            â”‚
â”‚  â”‚                                                                                  â”‚
â”‚  â”œâ”€ /studio/                      # å·¥ä½œå°ä¸“å±ž API                                  â”‚
â”‚  â”‚   â”œâ”€ /creator/                 # å¯¹è¯å¼åˆ›å»º                                      â”‚
â”‚  â”‚   â”‚   â””â”€ POST /chat            # å¯¹è¯åˆ›å»ºAgent                                   â”‚
â”‚  â”‚   â”‚                                                                              â”‚
â”‚  â”‚   â”œâ”€ /workflows/               # å·¥ä½œæµç®¡ç†                                      â”‚
â”‚  â”‚   â”‚   â”œâ”€ GET    /              # åˆ—è¡¨                                            â”‚
â”‚  â”‚   â”‚   â”œâ”€ POST   /              # åˆ›å»º                                            â”‚
â”‚  â”‚   â”‚   â”œâ”€ PUT    /{id}          # æ›´æ–°                                            â”‚
â”‚  â”‚   â”‚   â”œâ”€ POST   /{id}/compile  # ç¼–è¯‘ä¸ºæ‰§è¡Œé…ç½®                                  â”‚
â”‚  â”‚   â”‚   â””â”€ POST   /{id}/validate # éªŒè¯å·¥ä½œæµ                                      â”‚
â”‚  â”‚   â”‚                                                                              â”‚
â”‚  â”‚   â”œâ”€ /test/                    # æµ‹è¯•è¿è¡Œ                                        â”‚
â”‚  â”‚   â”‚   â”œâ”€ POST   /run           # è¿è¡Œæµ‹è¯• (SSE)                                  â”‚
â”‚  â”‚   â”‚   â””â”€ POST   /run-step      # å•æ­¥è¿è¡Œ                                        â”‚
â”‚  â”‚   â”‚                                                                              â”‚
â”‚  â”‚   â”œâ”€ /prompts/                 # æç¤ºè¯ç®¡ç†                                      â”‚
â”‚  â”‚   â”‚   â”œâ”€ GET    /{agent_id}/versions                                            â”‚
â”‚  â”‚   â”‚   â””â”€ POST   /{agent_id}/versions                                            â”‚
â”‚  â”‚   â”‚                                                                              â”‚
â”‚  â”‚   â”œâ”€ /deploy/                  # éƒ¨ç½²ç®¡ç†                                        â”‚
â”‚  â”‚   â”‚   â”œâ”€ POST   /              # åˆ›å»ºéƒ¨ç½²                                        â”‚
â”‚  â”‚   â”‚   â”œâ”€ PUT    /{id}/stop     # åœæ­¢                                            â”‚
â”‚  â”‚   â”‚   â””â”€ PUT    /{id}/restart  # é‡å¯                                            â”‚
â”‚  â”‚   â”‚                                                                              â”‚
â”‚  â”‚   â””â”€ /templates/               # æ¨¡æ¿å¸‚åœº                                        â”‚
â”‚  â”‚       â”œâ”€ GET    /              # æœç´¢æ¨¡æ¿                                        â”‚
â”‚  â”‚       â””â”€ POST   /{id}/use      # ä½¿ç”¨æ¨¡æ¿                                        â”‚
â”‚  â”‚                                                                                  â”‚
â”‚  â”œâ”€ /agents/                      # Agent ç®¡ç† (å…±ç”¨)                               â”‚
â”‚  â”‚   â”œâ”€ GET    /                  # åˆ—è¡¨                                            â”‚
â”‚  â”‚   â”œâ”€ POST   /                  # åˆ›å»º                                            â”‚
â”‚  â”‚   â”œâ”€ GET    /{id}              # è¯¦æƒ…                                            â”‚
â”‚  â”‚   â”œâ”€ PUT    /{id}              # æ›´æ–°                                            â”‚
â”‚  â”‚   â””â”€ DELETE /{id}              # åˆ é™¤                                            â”‚
â”‚  â”‚                                                                                  â”‚
â”‚  â”œâ”€ /chat/                        # å¯¹è¯ API (Agent Core)                           â”‚
â”‚  â”‚   â””â”€ POST   /                  # å‘é€æ¶ˆæ¯ (SSEæµå¼)                              â”‚
â”‚  â”‚                                                                                  â”‚
â”‚  â”œâ”€ /sessions/                    # ä¼šè¯ç®¡ç† (Agent Core)                           â”‚
â”‚  â”‚   â”œâ”€ GET    /                  # åˆ—è¡¨                                            â”‚
â”‚  â”‚   â”œâ”€ GET    /{id}/messages     # æ¶ˆæ¯åŽ†å²                                        â”‚
â”‚  â”‚   â””â”€ DELETE /{id}              # åˆ é™¤                                            â”‚
â”‚  â”‚                                                                                  â”‚
â”‚  â””â”€ /memory/                      # è®°å¿†ç®¡ç† (å…±ç”¨)                                 â”‚
â”‚      â”œâ”€ GET    /                  # åˆ—è¡¨                                            â”‚
â”‚      â”œâ”€ POST   /search            # æœç´¢                                            â”‚
â”‚      â””â”€ DELETE /{id}              # åˆ é™¤                                            â”‚
â”‚                                                                                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 6.2 å†…éƒ¨è°ƒç”¨æŽ¥å£

```python
# backend/studio/interfaces.py

from abc import ABC, abstractmethod
from typing import AsyncGenerator

class IAgentEngine(ABC):
    """Agent Engine æŽ¥å£ - å·¥ä½œå°è°ƒç”¨ Agent Core"""
    
    @abstractmethod
    async def run(
        self,
        user_input: str,
        session_id: str,
    ) -> AsyncGenerator[AgentEvent, None]:
        """æ‰§è¡Œ Agent"""
        pass
    
    @abstractmethod
    async def run_with_trace(
        self,
        user_input: str,
        session_id: str,
        variables: dict,
    ) -> AsyncGenerator[EngineEvent, None]:
        """å¸¦è¿½è¸ªçš„æ‰§è¡Œ"""
        pass

class IContextManager(ABC):
    """Context Manager æŽ¥å£"""
    
    @abstractmethod
    async def build(
        self,
        session_id: str,
        user_input: str,
        system_prompt: str,
    ) -> Context:
        """æž„å»ºä¸Šä¸‹æ–‡"""
        pass

class IToolExecutor(ABC):
    """Tool Executor æŽ¥å£"""
    
    @abstractmethod
    async def execute(
        self,
        name: str,
        arguments: dict,
        session_id: str,
    ) -> ToolResult:
        """æ‰§è¡Œå·¥å…·"""
        pass

class IMemoryManager(ABC):
    """Memory Manager æŽ¥å£"""
    
    @abstractmethod
    async def retrieve(
        self,
        query: str,
        session_id: str,
        max_tokens: int,
    ) -> list[MemoryItem]:
        """æ£€ç´¢è®°å¿†"""
        pass

class ILLMGateway(ABC):
    """LLM Gateway æŽ¥å£"""
    
    @abstractmethod
    async def chat(
        self,
        messages: list[dict],
        model: str,
        tools: list[dict] | None,
        stream: bool,
    ) -> AsyncGenerator[LLMChunk, None]:
        """è°ƒç”¨æ¨¡åž‹"""
        pass
```

---

## ä¸ƒã€ç›®å½•ç»“æž„å¯¹ç…§

```
backend/
â”œâ”€â”€ app/                           # åº”ç”¨å…¥å£
â”‚   â”œâ”€â”€ main.py
â”‚   â””â”€â”€ config.py
â”‚
â”œâ”€â”€ api/v1/                        # API è·¯ç”±
â”‚   â”œâ”€â”€ chat.py                    # å¯¹è¯ API (Agent Core)
â”‚   â”œâ”€â”€ agent.py                   # Agent ç®¡ç† (å…±ç”¨)
â”‚   â”œâ”€â”€ session.py                 # ä¼šè¯ç®¡ç† (Agent Core)
â”‚   â”œâ”€â”€ memory.py                  # è®°å¿†ç®¡ç† (å…±ç”¨)
â”‚   â””â”€â”€ studio.py                  # å·¥ä½œå° API (æ–°å¢ž)
â”‚
â”œâ”€â”€ core/                          # Agent Core (æ ¸å¿ƒå¼•æ“Ž)
â”‚   â”œâ”€â”€ agent/
â”‚   â”‚   â”œâ”€â”€ engine.py              # Agent æ‰§è¡Œå¼•æ“Ž
â”‚   â”‚   â”œâ”€â”€ loop.py                # Main Loop
â”‚   â”‚   â””â”€â”€ context.py             # ä¸Šä¸‹æ–‡ç®¡ç†
â”‚   â”œâ”€â”€ memory/
â”‚   â”‚   â”œâ”€â”€ manager.py             # è®°å¿†ç®¡ç†
â”‚   â”‚   â””â”€â”€ retriever.py           # è®°å¿†æ£€ç´¢
â”‚   â”œâ”€â”€ tool/
â”‚   â”‚   â”œâ”€â”€ registry.py            # å·¥å…·æ³¨å†Œ
â”‚   â”‚   â””â”€â”€ executor.py            # å·¥å…·æ‰§è¡Œ
â”‚   â””â”€â”€ llm/
â”‚       â””â”€â”€ gateway.py             # æ¨¡åž‹ç½‘å…³
â”‚
â”œâ”€â”€ studio/                        # å·¥ä½œå°æ¨¡å— (æ–°å¢ž)
â”‚   â”œâ”€â”€ orchestrator/              # ç¼–æŽ’å¼•æ“Ž
â”‚   â”‚   â”œâ”€â”€ engine.py              # ç¼–æŽ’æ‰§è¡Œ
â”‚   â”‚   â””â”€â”€ converter.py           # é…ç½®è½¬æ¢ (è°ƒç”¨ core)
â”‚   â”œâ”€â”€ creator/                   # å¯¹è¯åˆ›å»ºå™¨
â”‚   â”‚   â””â”€â”€ generator.py           # é…ç½®ç”Ÿæˆ (è°ƒç”¨ core.llm)
â”‚   â”œâ”€â”€ test_runner/               # æµ‹è¯•è¿è¡Œå™¨
â”‚   â”‚   â””â”€â”€ runner.py              # æµ‹è¯•æ‰§è¡Œ (è°ƒç”¨ core.agent)
â”‚   â”œâ”€â”€ deployer/                  # éƒ¨ç½²ç®¡ç†å™¨
â”‚   â”‚   â””â”€â”€ publisher.py           # å‘å¸ƒ (é…ç½® core.agent)
â”‚   â”œâ”€â”€ template/                  # æ¨¡æ¿ç®¡ç†
â”‚   â””â”€â”€ interfaces.py              # ä¸Ž Core çš„æŽ¥å£å®šä¹‰
â”‚
â”œâ”€â”€ models/                        # æ•°æ®æ¨¡åž‹ (å…±ç”¨)
â”‚   â”œâ”€â”€ agent.py                   # Agent (å…±ç”¨)
â”‚   â”œâ”€â”€ session.py                 # Session (Core)
â”‚   â”œâ”€â”€ message.py                 # Message (Core)
â”‚   â”œâ”€â”€ memory.py                  # Memory (å…±ç”¨)
â”‚   â”œâ”€â”€ workflow.py                # Workflow (Studio)
â”‚   â”œâ”€â”€ deployment.py              # Deployment (Studio)
â”‚   â””â”€â”€ template.py                # Template (Studio)
â”‚
â””â”€â”€ services/                      # ä¸šåŠ¡æœåŠ¡
    â”œâ”€â”€ chat.py                    # å¯¹è¯æœåŠ¡ (è°ƒç”¨ core.agent)
    â”œâ”€â”€ agent.py                   # Agent æœåŠ¡ (å…±ç”¨)
    â””â”€â”€ studio.py                  # å·¥ä½œå°æœåŠ¡ (è°ƒç”¨ studio/*)
```

---

## å…«ã€é›†æˆæ—¶åºå›¾

### 8.1 æµ‹è¯•è¿è¡Œæ—¶åº

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                             æµ‹è¯•è¿è¡Œæ—¶åºå›¾                                           â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                                     â”‚
â”‚  å‰ç«¯         StudioAPI      TestRunner       Converter      AgentEngine            â”‚
â”‚   â”‚              â”‚              â”‚                â”‚               â”‚                  â”‚
â”‚   â”‚â”€â”€POST /test/runâ”€â–¶â”‚              â”‚                â”‚               â”‚              â”‚
â”‚   â”‚              â”‚â”€â”€run()â”€â”€â”€â”€â”€â”€â”€â”€â–¶â”‚                â”‚               â”‚              â”‚
â”‚   â”‚              â”‚              â”‚â”€â”€get workflowâ”€â”€â–¶â”‚               â”‚              â”‚
â”‚   â”‚              â”‚              â”‚â—€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚               â”‚              â”‚
â”‚   â”‚              â”‚              â”‚â”€â”€convert()â”€â”€â”€â”€â”€â”€â–¶â”‚               â”‚              â”‚
â”‚   â”‚              â”‚              â”‚â—€â”€â”€AgentConfigâ”€â”€â”€â”€â”‚               â”‚              â”‚
â”‚   â”‚              â”‚              â”‚                  â”‚               â”‚              â”‚
â”‚   â”‚              â”‚              â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€run_with_trace()â”€â”€â”€â”€â”€â”€â”€â–¶â”‚              â”‚
â”‚   â”‚              â”‚              â”‚                  â”‚               â”‚              â”‚
â”‚   â”‚              â”‚              â”‚                  â”‚    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚              â”‚
â”‚   â”‚              â”‚              â”‚                  â”‚    â”‚Main Loopâ”‚â”‚              â”‚
â”‚   â”‚              â”‚              â”‚                  â”‚    â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜â”‚              â”‚
â”‚   â”‚              â”‚              â”‚                  â”‚         â”‚     â”‚              â”‚
â”‚   â”‚              â”‚              â”‚â—€â”€â”€â”€â”€â”€â”€TraceEvent: context_buildâ”€â”€â”‚              â”‚
â”‚   â”‚â—€â”€SSE eventâ”€â”€â”€â”‚â—€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚                  â”‚               â”‚              â”‚
â”‚   â”‚              â”‚              â”‚â—€â”€â”€â”€â”€â”€â”€TraceEvent: llm_callâ”€â”€â”€â”€â”€â”€â”€â”‚              â”‚
â”‚   â”‚â—€â”€SSE eventâ”€â”€â”€â”‚â—€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚                  â”‚               â”‚              â”‚
â”‚   â”‚              â”‚              â”‚â—€â”€â”€â”€â”€â”€â”€TraceEvent: tool_callâ”€â”€â”€â”€â”€â”€â”‚              â”‚
â”‚   â”‚â—€â”€SSE eventâ”€â”€â”€â”‚â—€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚                  â”‚               â”‚              â”‚
â”‚   â”‚              â”‚              â”‚â—€â”€â”€â”€â”€â”€â”€TraceEvent: doneâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚              â”‚
â”‚   â”‚â—€â”€SSE doneâ”€â”€â”€â”€â”‚â—€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚                  â”‚               â”‚              â”‚
â”‚   â”‚              â”‚              â”‚                  â”‚               â”‚              â”‚
â”‚                                                                                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 8.2 éƒ¨ç½²æ—¶åº

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                              éƒ¨ç½²æ—¶åºå›¾                                              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                                     â”‚
â”‚  å‰ç«¯        StudioAPI       Deployer        AgentRepo       AgentEngine            â”‚
â”‚   â”‚              â”‚              â”‚               â”‚               â”‚                   â”‚
â”‚   â”‚â”€â”€POST /deployâ”€â–¶â”‚              â”‚               â”‚               â”‚                 â”‚
â”‚   â”‚              â”‚â”€â”€deploy()â”€â”€â”€â”€â–¶â”‚               â”‚               â”‚                 â”‚
â”‚   â”‚              â”‚              â”‚                â”‚               â”‚                 â”‚
â”‚   â”‚              â”‚              â”‚â”€â”€1.èŽ·å–å·¥ä½œæµé…ç½®â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶â”‚                 â”‚
â”‚   â”‚              â”‚              â”‚â—€â”€â”€â”€â”€â”€â”€â”€compiled_configâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚                 â”‚
â”‚   â”‚              â”‚              â”‚                â”‚               â”‚                 â”‚
â”‚   â”‚              â”‚              â”‚â”€â”€2.éªŒè¯é…ç½®â”€â”€â”€â”€â–¶â”‚               â”‚                 â”‚
â”‚   â”‚              â”‚              â”‚â—€â”€â”€â”€okâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚               â”‚                 â”‚
â”‚   â”‚              â”‚              â”‚                â”‚               â”‚                 â”‚
â”‚   â”‚              â”‚              â”‚â”€â”€3.åˆ›å»º/æ›´æ–°Agenté…ç½®â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶â”‚                 â”‚
â”‚   â”‚              â”‚              â”‚â—€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚               â”‚                 â”‚
â”‚   â”‚              â”‚              â”‚                â”‚               â”‚                 â”‚
â”‚   â”‚              â”‚              â”‚â”€â”€4.ç”ŸæˆAPIç«¯ç‚¹â”€â”€â”‚               â”‚                 â”‚
â”‚   â”‚              â”‚              â”‚                â”‚               â”‚                 â”‚
â”‚   â”‚              â”‚              â”‚â”€â”€5.è®°å½•éƒ¨ç½²â”€â”€â”€â”€â–¶â”‚ (deployments) â”‚                 â”‚
â”‚   â”‚              â”‚              â”‚â—€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚               â”‚                 â”‚
â”‚   â”‚              â”‚              â”‚                â”‚               â”‚                 â”‚
â”‚   â”‚â—€â”€deployment infoâ”€â”‚â—€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚               â”‚               â”‚               â”‚
â”‚   â”‚              â”‚              â”‚                â”‚               â”‚                 â”‚
â”‚   â”‚              â”‚              â”‚                â”‚               â”‚                 â”‚
â”‚   â”‚                              â”‚                â”‚               â”‚                 â”‚
â”‚  ç”¨æˆ·è°ƒç”¨ API                    â”‚                â”‚               â”‚                 â”‚
â”‚   â”‚â”€â”€POST /api/v1/chatâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶â”‚                 â”‚
â”‚   â”‚                              â”‚                â”‚               â”‚â”€â”€run()         â”‚
â”‚   â”‚â—€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€å“åº”â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚                 â”‚
â”‚                                                                                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ä¹ã€æ€»ç»“

### é›†æˆè¦ç‚¹

| é›†æˆç‚¹ | å·¥ä½œå°èŒè´£ | Agent Core èŒè´£ | äº¤äº’æ–¹å¼ |
|--------|-----------|----------------|---------|
| **é…ç½®è½¬æ¢** | å¯è§†åŒ–ç¼–æŽ’ â†’ Workflow JSON | æ—  | Converter å•å‘è°ƒç”¨ |
| **æ‰§è¡Œè°ƒç”¨** | å‘èµ·æµ‹è¯•/éƒ¨ç½²è¯·æ±‚ | æ‰§è¡Œ Main Loop | æŽ¥å£è°ƒç”¨ + äº‹ä»¶å›žä¼  |
| **æ•°æ®å…±äº«** | ç®¡ç† workflow/deployment | ç®¡ç† session/message | å…±äº«æ•°æ®åº“ |
| **APIè¾¹ç•Œ** | /studio/* ç«¯ç‚¹ | /chat/* ç«¯ç‚¹ | REST + SSE |

### è®¾è®¡åŽŸåˆ™

1. **æ¾è€¦åˆ**: å·¥ä½œå°é€šè¿‡æŽ¥å£è°ƒç”¨ Agent Coreï¼Œä¸ç›´æŽ¥ä¾èµ–å†…éƒ¨å®žçŽ°
2. **å•å‘æ•°æ®æµ**: é…ç½®ä»Žå·¥ä½œå°æµå‘ Coreï¼Œæ‰§è¡Œæ•°æ®ä»Ž Core æµå›žå·¥ä½œå°
3. **å…±äº«åŸºç¡€è®¾æ–½**: å…±ç”¨æ•°æ®åº“ã€ç¼“å­˜ã€å‘é‡åº“
4. **ç‹¬ç«‹æ¼”è¿›**: ä¸¤ä¸ªæ¨¡å—å¯ä»¥ç‹¬ç«‹å¼€å‘å’Œéƒ¨ç½²

---

<div align="center">

**å·¥ä½œå°è´Ÿè´£è®¾è®¡ Â· Agent Core è´Ÿè´£æ‰§è¡Œ**

*æ–‡æ¡£ç‰ˆæœ¬: v1.0 | æœ€åŽæ›´æ–°: 2026-01-12*

</div>
